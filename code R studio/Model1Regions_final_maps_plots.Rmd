---
title: "Model1Regions_final_maps_plots"
author: "DS"
date: '2022-08-02'
output:
  word_document: default
  html_document: default
---

```{r}

library(`ftplottools`)
library("readxl")
library(tidyverse)
library(dplyr)
library(ggplot2)
library(sf)
library(ggplot2)
library(tmaptools)
library(leaflet)
library(rgdal)
library(spdep)
library(sp) 
library(RColorBrewer)
library(raster)
library(spData)
library(tmap)
library(ggpubr)
library(qwraps2)
library(gridExtra)
library(tibble)
library(ggpp)
library(arsenal)
library(gapminder)
library(ggplot2)
library(gganimate)
library(animation)
setwd("~/Все/Документы 2021/Charite/Master topic/R code")
russia <- read_excel("r_all_final_1.xlsx")
mydata <- read_excel("stat.xlsx")

```

```{r}
#We divide the data into 3 parts.In the regions, we also remove Sevastopol and Crimea due to insufficient data
russia_regions <- russia %>% 
  filter(VARNAME_1 != 'Central Federal District' & VARNAME_1 != 'North-Western Federal District' & VARNAME_1 != 'Southern Federal District' & VARNAME_1 != 'North Caucasus Federal District' & VARNAME_1 != 'Volga Federal District' & VARNAME_1 != 'Ural Federal District' & VARNAME_1 != 'Siberian Federal District' & VARNAME_1 != 'Far Eastern Federal District' & VARNAME_1 != 'Republic of Crimea' & VARNAME_1 != 'Sevastopol' & VARNAME_1 != 'Russian federation')
russia_district <- russia %>% 
  filter(VARNAME_1 == 'Central Federal District' | VARNAME_1 == 'North-Western Federal District' | VARNAME_1 == 'Southern Federal District' | VARNAME_1 == 'North Caucasus Federal District' | VARNAME_1 == 'Volga Federal District' | VARNAME_1 == 'Ural Federal District'|VARNAME_1 == 'Siberian Federal District' | VARNAME_1 == 'Far Eastern Federal District')

russia_all <-  russia %>% 
  filter(VARNAME_1 == 'Russian federation')

#We calculate the observed mortality per 100,000 people
russia_regions$observedmortal <-(russia_regions$All_case_deaths*100000)/russia_regions$`population average per year`
russia_district$observedmortal <- (russia_district$All_case_deaths*100000)/russia_district$`population average per year`
russia_all$observedmortal <- (russia_all$All_case_deaths*100000)/russia_all$`population average per year`

```


```{r}

#we divide the date set into a set before the pandemic and after .We have divided the pandemic into 2020 and 2021

before_russia_regions <-  russia_regions %>% 
  filter(Year != 2020 & Year != 2021)

pandemia_russia_regions<-  russia_regions %>% 
  filter(Year == 2020 | Year == 2021)

before_russia_district <-  russia_district %>% 
  filter(Year != 2020 & Year != 2021)

pandemia_russia_district<-  russia_district %>% 
  filter(Year == 2020 | Year == 2021)

before_russia_all <-  russia_all %>% 
  filter(Year != 2020 & Year != 2021)

pandemia_russia_all <-  russia_all %>% 
  filter(Year == 2020 | Year == 2021)

```

```{r}
#using Linear Models , we calculate the potential mortality from all causes . We use three models: the first model is all regions without including districts, the second model is only districts and the third model is the whole country. The positive performance of the model is reported in the internal check.

summary(mr1 <- lm(All_case_deaths ~ as.factor(mounth) +`Number of births`+ `population average per year`+`migration Number of arrivals`+`migration dropouts`, data = before_russia_regions))
  confint(mr1)
summary(mr2 <- lm(All_case_deaths ~ as.factor(mounth) +`Number of births`+ `population average per year`+`migration Number of arrivals`+`migration dropouts`, data = before_russia_district))
  confint(mr2)
summary(mr3 <- lm(All_case_deaths ~ as.factor(mounth) +`Number of births`+ `population average per year`+`migration Number of arrivals`+`migration dropouts`, data = before_russia_all))
  confint(mr3)
  
  
```

```{r}
#For external validation, in order to compare the predictive characteristics of the models, we will use two indicators: the mean absolute prediction error (MAE) and the mean square prediction error (MSE). MAE is more convenient because it provides a direct estimate of erroneously predicted deaths . MSE is useful because it is more closely related to the error that the models are trying to minimize in the sample.

#MAE.

library(abc)


mae3all <- sum(abs(pandemia_russia_all$All_case_deaths - pandemia_russia_all$expectdeaths))/length(pandemia_russia_all$All_case_deaths)


mae3regions <- sum(abs(pandemia_russia_regions$All_case_deaths - pandemia_russia_regions$expectdeaths))/length(pandemia_russia_regions$All_case_deaths)


mae3district <- sum(abs(pandemia_russia_district$All_case_deaths - pandemia_russia_district$expectdeaths))/length(pandemia_russia_district$All_case_deaths)

mae3all
mae3regions
mae3district

#MSE.


mse3all <- mean((pandemia_russia_all$All_case_deaths - pandemia_russia_all$expectdeaths)^2)


mse3regions <- mean((pandemia_russia_regions$All_case_deaths - pandemia_russia_regions$expectdeaths)^2)



mse3district <- mean((pandemia_russia_district$All_case_deaths - pandemia_russia_district$expectdeaths)^2)

mse3all
mse3regions
mse3district

#From the output data we can see that MAE mr 1 is 696.7366. Multiplying this by 12 months and 146.7 million (the total population in 2020), we get 1.2 million erroneously predicted deaths per year.MSE = 1085882. Adjusted R-squared:  0.8915  

```

```{r}

#Using the mr1 model
pandemia_russia_regions$expectdeaths <-  predict(mr1, newdata = pandemia_russia_regions)
pandemia_russia_district$expectdeaths <-  predict(mr1, newdata = pandemia_russia_district)
pandemia_russia_all$expectdeaths <-  predict(mr1, newdata = pandemia_russia_all)
```

```{r}

#We get excess mortality this is the difference between observed mortality and expected mortality

pandemia_russia_regions$excessdeaths <- pandemia_russia_regions$All_case_deaths - pandemia_russia_regions$expectdeaths
pandemia_russia_district$excessdeaths <- pandemia_russia_district$All_case_deaths - pandemia_russia_district$expectdeaths
pandemia_russia_all$excessdeaths <- pandemia_russia_all$All_case_deaths - pandemia_russia_all$expectdeaths

pandemia_russia_regions$expectmortal <- (pandemia_russia_regions$expectdeaths*100000)/pandemia_russia_regions$`population average per year`
pandemia_russia_district$expectmortal <- (pandemia_russia_district$expectdeaths*100000)/pandemia_russia_district$`population average per year`

pandemia_russia_regions$MR <- round((pandemia_russia_regions$All_case_deaths/pandemia_russia_regions$`population average per year`)*100000,digits=2)

before_russia_regions$MR <- round((before_russia_regions$All_case_deaths/before_russia_regions$`population average per year`)*100000,digits=2)

before_russia_all$MR <- round((before_russia_all$All_case_deaths/before_russia_all$`population average per year`)*100000,digits=2)
                          
pandemia_russia_all$MR <- round((pandemia_russia_all$All_case_deaths/pandemia_russia_all$`population average per year`)*100000,digits=2)

before_russia_district$MR<-round((before_russia_district$All_case_deaths/before_russia_district$`population average per year`)*100000,digits=2)

pandemia_russia_district$MR <- round((pandemia_russia_district$All_case_deaths/pandemia_russia_district$`population average per year`)*100000,digits=2)

```

```{r}

pandemia_russia_regions2020 <- pandemia_russia_regions %>% 
  filter( Year == 2020)
pandemia_russia_regions2020_before_russia<-  pandemia_russia_regions %>% 
  filter(Year != 2021)
pandemia_russia_regions2021 <- pandemia_russia_regions %>% 
  filter( Year == 2021)

pandemia_russia_district2020 <- pandemia_russia_district %>% 
  filter( Year == 2020)
pandemia_russia_district2020_before_russia <-  pandemia_russia_district %>% 
  filter(Year != 2021)
pandemia_russia_district2021 <- pandemia_russia_district %>% 
  filter( Year == 2021)

pandemia_russia_all2020 <- pandemia_russia_all %>% 
  filter( Year == 2020)
pandemia_russia_all2020_before_russia <-  pandemia_russia_all %>% 
  filter(Year != 2021)
pandemia_russia_all2021 <- pandemia_russia_all %>% 
  filter( Year == 2021)

```



```{r}
Central_Federal_District_before <- before_russia_regions %>% 
  filter(VARNAME_1 == 'Belgorod region' | VARNAME_1 == 'Bryansk region'| VARNAME_1 == 'Vladimir region' |VARNAME_1 == 'Voronezh Region'|VARNAME_1 == 'Ivanovo region'|VARNAME_1 == 'Kaluga Region'|VARNAME_1 == 'Kostroma region'|VARNAME_1 == 'Kursk region'|VARNAME_1 == 'Lipetsk region'|VARNAME_1 == 'Moscow oblast'|VARNAME_1 == 'Oryol region'|VARNAME_1 == 'Ryazan region'|VARNAME_1 == 'Smolensk region'|VARNAME_1 == 'Tambov region'|VARNAME_1 == 'Tver region'|VARNAME_1 == 'Tula region'|VARNAME_1 == 'Yaroslavl region'|VARNAME_1 == 'Moscow')

Central_Federal_District_pandemia <-pandemia_russia_regions %>% 
 filter(VARNAME_1 == 'Belgorod region' | VARNAME_1 == 'Bryansk region'| VARNAME_1 == 'Vladimir region' |VARNAME_1 == 'Voronezh Region'|VARNAME_1 == 'Ivanovo region'|VARNAME_1 == 'Kaluga Region'|VARNAME_1 == 'Kostroma region'|VARNAME_1 == 'Kursk region'|VARNAME_1 == 'Lipetsk region'|VARNAME_1 == 'Moscow oblast'|VARNAME_1 == 'Oryol region'|VARNAME_1 == 'Ryazan region'|VARNAME_1 == 'Smolensk region'|VARNAME_1 == 'Tambov region'|VARNAME_1 == 'Tver region'|VARNAME_1 == 'Tula region'|VARNAME_1 == 'Yaroslavl region'|VARNAME_1 == 'Moscow')

North_Western_Federal_District_before <- before_russia_regions %>% 
  filter(VARNAME_1 == 'Republic of Karelia'|VARNAME_1 == 'Komi Republic'|VARNAME_1 == 'Arkhangelsk region'|VARNAME_1 == 'Vologda region'|VARNAME_1 == 'Kaliningrad Region'|VARNAME_1 == 'Leningrad Regiongion'|VARNAME_1 == 'Murmansk region'|VARNAME_1 == 'Novgorod region'|VARNAME_1 == 'Pskov region
'|VARNAME_1 == 'St. Petersburg')

North_Western_Federal_District_pandemia <- pandemia_russia_regions %>% 
  filter(VARNAME_1 == 'Republic of Karelia'|VARNAME_1 == 'Komi Republic'|VARNAME_1 == 'Arkhangelsk region'|VARNAME_1 == 'Vologda region'|VARNAME_1 == 'Kaliningrad Region'|VARNAME_1 == 'Leningrad Regiongion'|VARNAME_1 == 'Murmansk region'|VARNAME_1 == 'Novgorod region'|VARNAME_1 == 'Pskov region
'|VARNAME_1 == 'St. Petersburg')

Southern_Federal_District_before <- before_russia_regions %>% 
  filter(VARNAME_1 == 'Republic of Adygea (Adygea)'|VARNAME_1 == 'Republic of Kalmykia'|VARNAME_1 == 'Krasnodarskiy kray'|VARNAME_1 == 'Astrakhan region'|VARNAME_1 == 'Volgograd region'|VARNAME_1 == 'Rostov region')

Southern_Federal_District_pandemia <- pandemia_russia_regions %>% 
  filter(VARNAME_1 == 'Republic of Adygea (Adygea)'|VARNAME_1 == 'Republic of Kalmykia'|VARNAME_1 == 'Krasnodarskiy kray'|VARNAME_1 == 'Astrakhan region'|VARNAME_1 == 'Volgograd region'|VARNAME_1 == 'Rostov region')

North_Caucasus_Federal_District_before <- before_russia_regions %>% 
  filter(VARNAME_1 == 'Republic of Dagestan'|VARNAME_1 == 'Republic of Ingushetia'|VARNAME_1 == 'Kabardino-Balkarian Republic'|VARNAME_1 == 'Karachay-Cherkess Republic'|VARNAME_1 == 'Republic of North Ossetia - Alania'|VARNAME_1 == 'Chechen Republic'|VARNAME_1 == 'Stavropol Territory')

North_Caucasus_Federal_District_pandemia <- pandemia_russia_regions %>% 
  filter(VARNAME_1 == 'Republic of Dagestan'|VARNAME_1 == 'Republic of Ingushetia'|VARNAME_1 == 'Kabardino-Balkarian Republic'|VARNAME_1 == 'Karachay-Cherkess Republic'|VARNAME_1 == 'Republic of North Ossetia - Alania'|VARNAME_1 == 'Chechen Republic'|VARNAME_1 == 'Stavropol Territory')

Volga_Federal_District_before <- before_russia_regions %>% 
  filter(VARNAME_1 == 'Republic of Bashkortostan'|VARNAME_1 == 'Republic of Mari El'|VARNAME_1 == 'Republic of Mordovia'|VARNAME_1 == 'Republic of Tatarstan (Tatarstan)'|VARNAME_1 == 'Udmurt Republic
'|VARNAME_1 == 'Chuvash Republic - Chuvashia'|VARNAME_1 == 'Perm Region'|VARNAME_1 == 'Kirov region'|VARNAME_1 == 'Nizhny Novgorod region'|VARNAME_1 == 'Orenburg region'|VARNAME_1 == 'Penza region'|VARNAME_1 == 'Samara region'|VARNAME_1 == 'Saratov region'|VARNAME_1 == 'Ulyanovsk region')

Volga_Federal_District_pandemia <- pandemia_russia_regions %>% 
  filter(VARNAME_1 == 'Republic of Bashkortostan'|VARNAME_1 == 'Republic of Mari El'|VARNAME_1 == 'Republic of Mordovia'|VARNAME_1 == 'Republic of Tatarstan (Tatarstan)'|VARNAME_1 == 'Udmurt Republic
'|VARNAME_1 == 'Chuvash Republic - Chuvashia'|VARNAME_1 == 'Perm Region'|VARNAME_1 == 'Kirov region'|VARNAME_1 == 'Nizhny Novgorod region'|VARNAME_1 == 'Orenburg region'|VARNAME_1 == 'Penza region'|VARNAME_1 == 'Samara region'|VARNAME_1 == 'Saratov region'|VARNAME_1 == 'Ulyanovsk region')

Ural_Federal_District_before <- before_russia_regions %>% 
  filter(VARNAME_1 == 'Kurgan region'|VARNAME_1 == 'Sverdlovsk region'|VARNAME_1 == 'Chelyabinsk region'|VARNAME_1 == 'Tyumen region'|VARNAME_1 == 'Khanty-Mansi Autonomous Okrug - Yugra'|VARNAME_1 == 'Yamalo-Nenets Autonomous Okrug')

Ural_Federal_District_pandemia <- pandemia_russia_regions %>% 
  filter(VARNAME_1 == 'Kurgan region'|VARNAME_1 == 'Sverdlovsk region'|VARNAME_1 == 'Chelyabinsk region'|VARNAME_1 == 'Tyumen region'|VARNAME_1 == 'Khanty-Mansi Autonomous Okrug - Yugra'|VARNAME_1 == 'Yamalo-Nenets Autonomous Okrug')

Siberian_Federal_District_before <- before_russia_regions %>% 
  filter(VARNAME_1 == 'Altai Republic'|VARNAME_1 == 'Republic of Tyva'|VARNAME_1 == 'Republic of Khakassia'|VARNAME_1 == 'Altai Territory'|VARNAME_1 == 'Krasnoyarsk Territory'|VARNAME_1 == 'Irkutsk region'|VARNAME_1 == 'Kemerovo Region - Kuzbass'|VARNAME_1 == 'Novosibirsk region'|VARNAME_1 == 'Omsk region'|VARNAME_1 == 'Tomsk region')

Siberian_Federal_District_pandemia <- pandemia_russia_regions %>% 
  filter(VARNAME_1 == 'Altai Republic'|VARNAME_1 == 'Republic of Tyva'|VARNAME_1 == 'Republic of Khakassia'|VARNAME_1 == 'Altai Territory'|VARNAME_1 == 'Krasnoyarsk Territory'|VARNAME_1 == 'Irkutsk region'|VARNAME_1 == 'Kemerovo Region - Kuzbass'|VARNAME_1 == 'Novosibirsk region'|VARNAME_1 == 'Omsk region'|VARNAME_1 == 'Tomsk region')

Far_Eastern_Federal_District_before <- before_russia_regions %>% 
  filter(VARNAME_1 == 'Republic of Buryatia'|VARNAME_1 == 'Trans - Baikal Territory'|VARNAME_1 == 'Republic of Sakha (Yakutia)'|VARNAME_1 == 'Kamchatka Krai'|VARNAME_1 == 'Primorsky Krai'|VARNAME_1 == 'Khabarovsk Territory'|VARNAME_1 == 'Amur region'|VARNAME_1 == 'Magadan region'|VARNAME_1 == 'Sakhalin region'|VARNAME_1 == 'Jewish Autonomous Region'|VARNAME_1 == 'Chukotka Autonomous Okrug')

Far_Eastern_Federal_District_pandemia <- pandemia_russia_regions %>% 
  filter(VARNAME_1 == 'Republic of Buryatia'|VARNAME_1 == 'Trans - Baikal Territory'|VARNAME_1 == 'Republic of Sakha (Yakutia)'|VARNAME_1 == 'Kamchatka Krai'|VARNAME_1 == 'Primorsky Krai'|VARNAME_1 == 'Khabarovsk Territory'|VARNAME_1 == 'Amur region'|VARNAME_1 == 'Magadan region'|VARNAME_1 == 'Sakhalin region'|VARNAME_1 == 'Jewish Autonomous Region'|VARNAME_1 == 'Chukotka Autonomous Okrug')



```





```{r}
#setwd("C:/Users/AVGUST/Desktop")
setwd("~/Все/Документы 2021/Charite/Master topic/R code")
rus <- load("RUS_adm1.RData")

proj4.str <- CRS("+init=epsg:3413 +lon_0=105")
gadm.prj <- spTransform(gadm, proj4.str)

# merging all polygons to create data file
df <- fortify(gadm.prj, region = "ID_1")
# as some of regions may not be included, again merging process take place
df2 <- merge(df, gadm.prj, by.x = "id", by.y = "ID_1",group = NL_NAME_1)

mydata$id <- as.character(mydata$id)

mapdata <- inner_join(df2,mydata,by="id")

mapdata1<-mapdata %>% filter(!is.na(mapdata$TEST_DATA ))
```

```{r}
#Creating a map with selected districts and one empty map

library()
map<-ggplot(mapdata1, aes( x = `long`, y = `lat`, group=group)) +
  geom_polygon(aes(), color = "black")
map

map_district<-ggplot(mapdata1, aes( x = `long`, y = `lat`, group=group)) +geom_polygon(aes(), color = "black")+
  geom_polygon( data = (mapdata1[mapdata1$id == "8",]), aes( x = `long`, y = `lat`, group=group), color = "red")+ 
  geom_polygon( data = (mapdata1[mapdata1$id == "9",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
  geom_polygon( data = (mapdata1[mapdata1$id == "22",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
  geom_polygon( data = (mapdata1[mapdata1$id == "26",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
  geom_polygon( data = (mapdata1[mapdata1$id == "38",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
  geom_polygon( data = (mapdata1[mapdata1$id == "42",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
  geom_polygon( data = (mapdata1[mapdata1$id == "44",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
  geom_polygon( data = (mapdata1[mapdata1$id == "48",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
  geom_polygon( data = (mapdata1[mapdata1$id == "49",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
  geom_polygon( data = (mapdata1[mapdata1$id == "57",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
  geom_polygon( data = (mapdata1[mapdata1$id == "64",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
  geom_polygon( data = (mapdata1[mapdata1$id == "69",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
  geom_polygon( data = (mapdata1[mapdata1$id == "72",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
  geom_polygon( data = (mapdata1[mapdata1$id == "76",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
  geom_polygon( data = (mapdata1[mapdata1$id == "78",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
  geom_polygon( data = (mapdata1[mapdata1$id == "83",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
  geom_polygon( data = (mapdata1[mapdata1$id == "86",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
  geom_polygon( data = (mapdata1[mapdata1$id == "88",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
  geom_polygon( data = (mapdata1[mapdata1$id == "5",]), aes( x = `long`, y = `lat`, group=group), color = "chartreuse1")+
  geom_polygon( data = (mapdata1[mapdata1$id == "16",]), aes( x = `long`, y = `lat`, group=group), color = "chartreuse1")+
  geom_polygon( data = (mapdata1[mapdata1$id == "24",]), aes( x = `long`, y = `lat`, group=group), color = "chartreuse1")+
  geom_polygon( data = (mapdata1[mapdata1$id == "29",]), aes( x = `long`, y = `lat`, group=group), color = "chartreuse1")+
  geom_polygon( data = (mapdata1[mapdata1$id == "36",]), aes( x = `long`, y = `lat`, group=group), color = "chartreuse1")+
  geom_polygon( data = (mapdata1[mapdata1$id == "43",]), aes( x = `long`, y = `lat`, group=group), color = "chartreuse1")+
  geom_polygon( data = (mapdata1[mapdata1$id == "50",]), aes( x = `long`, y = `lat`, group=group), color = "chartreuse1")+
  geom_polygon( data = (mapdata1[mapdata1$id == "51",]), aes( x = `long`, y = `lat`, group=group), color = "chartreuse1")+
  geom_polygon( data = (mapdata1[mapdata1$id == "54",]), aes( x = `long`, y = `lat`, group=group), color = "chartreuse1")+
  geom_polygon( data = (mapdata1[mapdata1$id == "62",]), aes( x = `long`, y = `lat`, group=group), color = "chartreuse1")+
  geom_polygon( data = (mapdata1[mapdata1$id == "85",]), aes( x = `long`, y = `lat`, group=group), color = "chartreuse1")+
  geom_polygon( data = (mapdata1[mapdata1$id == "1",]), aes( x = `long`, y = `lat`, group=group), color = "blue")+ 
  geom_polygon( data = (mapdata1[mapdata1$id == "6",]), aes( x = `long`, y = `lat`, group=group), color = "blue")+
  geom_polygon( data = (mapdata1[mapdata1$id == "25",]), aes( x = `long`, y = `lat`, group=group), color = "blue")+
  geom_polygon( data = (mapdata1[mapdata1$id == "39",]), aes( x = `long`, y = `lat`, group=group), color = "blue")+
  geom_polygon( data = (mapdata1[mapdata1$id == "63",]), aes( x = `long`, y = `lat`, group=group), color = "blue")+
  geom_polygon( data = (mapdata1[mapdata1$id == "84",]), aes( x = `long`, y = `lat`, group=group), color = "blue")+
  geom_polygon( data = (mapdata1[mapdata1$id == "17",]), aes( x = `long`, y = `lat`, group=group), color = "cyan")+ 
  geom_polygon( data = (mapdata1[mapdata1$id == "11",]), aes( x = `long`, y = `lat`, group=group), color = "cyan")+
  geom_polygon( data = (mapdata1[mapdata1$id == "20",]), aes( x = `long`, y = `lat`, group=group), color = "cyan")+
  geom_polygon( data = (mapdata1[mapdata1$id == "23",]), aes( x = `long`, y = `lat`, group=group), color = "cyan")+
  geom_polygon( data = (mapdata1[mapdata1$id == "28",]), aes( x = `long`, y = `lat`, group=group), color = "cyan")+
  geom_polygon( data = (mapdata1[mapdata1$id == "53",]), aes( x = `long`, y = `lat`, group=group), color = "cyan")+
  geom_polygon( data = (mapdata1[mapdata1$id == "70",]), aes( x = `long`, y = `lat`, group=group), color = "cyan")+
  geom_polygon( data = (mapdata1[mapdata1$id == "7",]), aes( x = `long`, y = `lat`, group=group), color = "azure")+ 
  geom_polygon( data = (mapdata1[mapdata1$id == "15",]), aes( x = `long`, y = `lat`, group=group), color = "azure")+
  geom_polygon( data = (mapdata1[mapdata1$id == "34",]), aes( x = `long`, y = `lat`, group=group), color = "azure")+
  geom_polygon( data = (mapdata1[mapdata1$id == "35",]), aes( x = `long`, y = `lat`, group=group), color = "azure")+
  geom_polygon( data = (mapdata1[mapdata1$id == "46",]), aes( x = `long`, y = `lat`, group=group), color = "azure")+
  geom_polygon( data = (mapdata1[mapdata1$id == "47",]), aes( x = `long`, y = `lat`, group=group), color = "azure")+
  geom_polygon( data = (mapdata1[mapdata1$id == "52",]), aes( x = `long`, y = `lat`, group=group), color = "azure")+
  geom_polygon( data = (mapdata1[mapdata1$id == "58",]), aes( x = `long`, y = `lat`, group=group), color = "azure")+
  geom_polygon( data = (mapdata1[mapdata1$id == "59",]), aes( x = `long`, y = `lat`, group=group), color = "azure")+
  geom_polygon( data = (mapdata1[mapdata1$id == "60",]), aes( x = `long`, y = `lat`, group=group), color = "azure")+
  geom_polygon( data = (mapdata1[mapdata1$id == "67",]), aes( x = `long`, y = `lat`, group=group), color = "azure")+
  geom_polygon( data = (mapdata1[mapdata1$id == "68",]), aes( x = `long`, y = `lat`, group=group), color = "azure")+
  geom_polygon( data = (mapdata1[mapdata1$id == "73",]), aes( x = `long`, y = `lat`, group=group), color = "azure")+
  geom_polygon( data = (mapdata1[mapdata1$id == "80",]), aes( x = `long`, y = `lat`, group=group), color = "azure")+
  geom_polygon( data = (mapdata1[mapdata1$id == "81",]), aes( x = `long`, y = `lat`, group=group), color = "azure")+
  geom_polygon( data = (mapdata1[mapdata1$id == "93",]), aes( x = `long`, y = `lat`, group=group), color = "azure")+
  geom_polygon( data = (mapdata1[mapdata1$id == "12",]), aes( x = `long`, y = `lat`, group=group), color = "deeppink")+ 
  geom_polygon( data = (mapdata1[mapdata1$id == "33",]), aes( x = `long`, y = `lat`, group=group), color = "deeppink")+
  geom_polygon( data = (mapdata1[mapdata1$id == "41",]), aes( x = `long`, y = `lat`, group=group), color = "deeppink")+
  geom_polygon( data = (mapdata1[mapdata1$id == "71",]), aes( x = `long`, y = `lat`, group=group), color = "deeppink")+
  geom_polygon( data = (mapdata1[mapdata1$id == "79",]), aes( x = `long`, y = `lat`, group=group), color = "deeppink")+
  geom_polygon( data = (mapdata1[mapdata1$id == "87",]), aes( x = `long`, y = `lat`, group=group), color = "deeppink")+
  geom_polygon( data = (mapdata1[mapdata1$id == "2",]), aes( x = `long`, y = `lat`, group=group), color = "darksalmon")+ 
  geom_polygon( data = (mapdata1[mapdata1$id == "3",]), aes( x = `long`, y = `lat`, group=group), color = "darksalmon")+
  geom_polygon( data = (mapdata1[mapdata1$id == "13",]), aes( x = `long`, y = `lat`, group=group), color = "deepskyblue")+
  geom_polygon( data = (mapdata1[mapdata1$id == "18",]), aes( x = `long`, y = `lat`, group=group), color = "darksalmon")+
  geom_polygon( data = (mapdata1[mapdata1$id == "19",]), aes( x = `long`, y = `lat`, group=group), color = "darksalmon")+
  geom_polygon( data = (mapdata1[mapdata1$id == "21",]), aes( x = `long`, y = `lat`, group=group), color = "darksalmon")+
  geom_polygon( data = (mapdata1[mapdata1$id == "30",]), aes( x = `long`, y = `lat`, group=group), color = "darksalmon")+ 
  geom_polygon( data = (mapdata1[mapdata1$id == "32",]), aes( x = `long`, y = `lat`, group=group), color = "darksalmon")+
  geom_polygon( data = (mapdata1[mapdata1$id == "40",]), aes( x = `long`, y = `lat`, group=group), color = "darksalmon")+
  geom_polygon( data = (mapdata1[mapdata1$id == "55",]), aes( x = `long`, y = `lat`, group=group), color = "darksalmon")+
  geom_polygon( data = (mapdata1[mapdata1$id == "56",]), aes( x = `long`, y = `lat`, group=group), color = "darksalmon")+
  geom_polygon( data = (mapdata1[mapdata1$id == "74",]), aes( x = `long`, y = `lat`, group=group), color = "darksalmon")+
  geom_polygon( data = (mapdata1[mapdata1$id == "75",]), aes( x = `long`, y = `lat`, group=group), color = "darksalmon")+ 
  geom_polygon( data = (mapdata1[mapdata1$id == "77",]), aes( x = `long`, y = `lat`, group=group), color = "darksalmon")+
  geom_polygon( data = (mapdata1[mapdata1$id == "82",]), aes( x = `long`, y = `lat`, group=group), color = "darksalmon")+
  geom_polygon( data = (mapdata1[mapdata1$id == "94",]), aes( x = `long`, y = `lat`, group=group), color = "darksalmon")+
  geom_polygon( data = (mapdata1[mapdata1$id == "95",]), aes( x = `long`, y = `lat`, group=group), color = "darksalmon")+
  geom_polygon( data = (mapdata1[mapdata1$id == "4",]), aes( x = `long`, y = `lat`, group=group), color = "deepskyblue")+ 
  geom_polygon( data = (mapdata1[mapdata1$id == "10",]), aes( x = `long`, y = `lat`, group=group), color = "deepskyblue")+
  geom_polygon( data = (mapdata1[mapdata1$id == "14",]), aes( x = `long`, y = `lat`, group=group), color = "deepskyblue")+
  geom_polygon( data = (mapdata1[mapdata1$id == "27",]), aes( x = `long`, y = `lat`, group=group), color = "deepskyblue")+
  geom_polygon( data = (mapdata1[mapdata1$id == "31",]), aes( x = `long`, y = `lat`, group=group), color = "deepskyblue")+
  geom_polygon( data = (mapdata1[mapdata1$id == "37",]), aes( x = `long`, y = `lat`, group=group), color = "deepskyblue")+
  geom_polygon( data = (mapdata1[mapdata1$id == "45",]), aes( x = `long`, y = `lat`, group=group), color = "deepskyblue")+
  geom_polygon( data = (mapdata1[mapdata1$id == "61",]), aes( x = `long`, y = `lat`, group=group), color = "deepskyblue")+
  geom_polygon( data = (mapdata1[mapdata1$id == "65",]), aes( x = `long`, y = `lat`, group=group), color = "deepskyblue")+
  geom_polygon( data = (mapdata1[mapdata1$id == "66",]), aes( x = `long`, y = `lat`, group=group), color = "deepskyblue")+
  geom_polygon( data = (mapdata1[mapdata1$id == "89",]), aes( x = `long`, y = `lat`, group=group), color = "deepskyblue")+
  geom_polygon( data = (mapdata1[mapdata1$id == "91",]), aes( x = `long`, y = `lat`, group=group), color = "deepskyblue")+
  geom_polygon( data = (mapdata1[mapdata1$id == "92",]), aes( x = `long`, y = `lat`, group=group), color = "deepskyblue")
  

map_district 

```

```{r}

#creating a map with mortality in all regions

map2 <-map +  scale_fill_viridis_c(option = "plasma",direction = -1)+
    theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())+
  geom_polygon(aes(fill = DR2020), color = "black")
map2
map3 <- map +  scale_fill_viridis_c(option = "plasma",direction = -1)+
    theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())+
  geom_polygon(aes(fill = DR2021), color = "black")
map3


```



#The next part is the part for creating maps with a color palette for mortality in each region, as well as the name and location on the geographical map. Also creating a summary table of descriptive statistical analysis.In it, I specify confidence intervals, average stash, minimum-maximum mortality.


```{r}
write.csv2(Central_Federal_District_pandemia, file = "Central_Federal_District_pandemia.csv")



```

```{r}


map4<-ggplot(mapdata1, aes( x = `long`, y = `lat`, group=group)) +geom_polygon(aes(), color = "black")+
   geom_polygon( data = (mapdata1[mapdata1$id == "8",]), aes( x = `long`, y = `lat`, group=group), color = "red")+ 
   geom_polygon( data = (mapdata1[mapdata1$id == "9",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "22",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "26",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "38",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "42",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "44",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "48",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "49",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "57",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "64",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "69",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "72",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "76",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "78",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "83",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "86",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "88",]), aes( x = `long`, y = `lat`, group=group), color = "red")
map4

mapdata2 <- mapdata1 %>% 
  filter(id == 8 | id == 9| id ==22 | id ==26 | id ==38 | id ==42 | id ==44 | id ==48 | id ==49 | id ==57 | id ==64 | id ==69 | id ==72 | id ==76 | id ==78 | id ==83 | id ==86 | id ==88 )
map5<-ggplot(mapdata2, aes( x = `long`, y = `lat`, group=group)) +
  geom_polygon(aes(fill = DR2020), color = "black")+
  scale_fill_viridis_c(option = "plasma",direction = -1)+
    theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())+
  geom_polygon(aes(fill = DR2020), color = "black")

map5

mapdata2 <- mapdata1 %>% 
  filter(id == 8 | id == 9| id ==22 | id ==26 | id ==38 | id ==42 | id ==44 | id ==48 | id ==49 | id ==57 | id ==64 | id ==69 | id ==72 | id ==76 | id ==78 | id ==83 | id ==86 | id ==88 )
map6<-ggplot(mapdata2, aes( x = `long`, y = `lat`, group=group)) +
  geom_polygon(aes(fill = DR2021), color = "black")+
   scale_fill_viridis_c(option = "plasma",direction = -1)+
    theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())+
  geom_polygon(aes(fill = DR2021), color = "black")
 
map6

ggplot(mapdata2, aes(x = long, y = lat, group = group), height = 10000, width = 2500) + 
    geom_polygon(aes(fill = (...2))) + ggtitle("CENTRAL FEDERAL DISTRICT") + 
    xlab("Longitude") + ylab("Latitude")+ theme(legend.position="top")

```




```{r}
library(dplyr)
final_tab_pandemia_russia_all <- pandemia_russia_all%>%
   group_by(Year ) %>%
   dplyr::summarise(
    mean = round(mean(MR),digits =2),
    lci = round(t.test(MR, conf.level = 0.95)$conf.int[1],digits =2),
    uci =round( t.test(MR, conf.level = 0.95)$conf.int[2],digits =2),MR = sum(MR),All_case_deaths_max=max(All_case_deaths),All_case_deaths_min=min(All_case_deaths),All_case_deaths=sum(All_case_deaths),IR=round(sum(IR,na.rm=TRUE),digits =2),excessdeaths=round(sum(excessdeaths),digits =2),expectdeaths=sum(expectdeaths))
final_tab_pandemia_russia_all

write.csv2(final_tab_pandemia_russia_all, file = "final_tab_pandemia_russia_all.csv")



final_tab_before_russia_all <- before_russia_all%>%
    group_by(Year ) %>%
    dplyr::summarise( 
      mean = round(mean(MR),digits =2),
    lci = round(t.test(MR, conf.level = 0.95)$conf.int[1],digits =2),
    uci =round( t.test(MR, conf.level = 0.95)$conf.int[2],digits =2),MR = sum(MR),
      All_case_deaths=sum(All_case_deaths),)
final_tab_before_russia_all
write.csv2(final_tab_before_russia_all, file = "final_tab_before_russia_all.csv")

```

```{r}
library(dplyr)
final_tab_pandemia_russia_district <- pandemia_russia_district%>%
   group_by(VARNAME_1,Year ) %>%
   dplyr::summarise(
    mean = round(mean(MR),digits =2),
    lci = round(t.test(MR, conf.level = 0.95)$conf.int[1],digits =2),
    uci =round( t.test(MR, conf.level = 0.95)$conf.int[2],digits =2),MR = sum(MR),All_case_deaths_max=max(All_case_deaths),All_case_deaths_min=min(All_case_deaths),All_case_deaths=sum(All_case_deaths),IR=round(sum(IR,na.rm=TRUE),digits =2),excessdeaths=round(sum(excessdeaths),digits =2),expectdeaths=sum(expectdeaths))
final_tab_pandemia_russia_district

write.csv2(final_tab_pandemia_russia_district, file = "final_tab_pandemia_russia_district.csv")



final_tab_before_russia_district <- before_russia_district%>%
    group_by(VARNAME_1,Year ) %>%
    dplyr::summarise(  
      mean = round(mean(MR),digits =2),
    lci = round(t.test(MR, conf.level = 0.95)$conf.int[1],digits =2),
    uci =round( t.test(MR, conf.level = 0.95)$conf.int[2],digits =2),MR = sum(MR),
      All_case_deaths=sum(All_case_deaths),)
final_tab_before_russia_district
write.csv2(final_tab_before_russia_district, file = "final_tab_before_russia_district.csv")
```


```{r}
library(dplyr)
final_tab_regions_pandemia <- pandemia_russia_regions%>%
   group_by(VARNAME_1,Year ) %>%
   dplyr::summarise(
    mean = round(mean(MR),digits =2),
    lci = round(t.test(MR, conf.level = 0.95)$conf.int[1],digits =2),
    uci =round( t.test(MR, conf.level = 0.95)$conf.int[2],digits =2),MR = sum(MR),All_case_deaths_max=max(All_case_deaths),All_case_deaths_min=min(All_case_deaths),All_case_deaths=sum(All_case_deaths),IR=round(sum(IR,na.rm=TRUE),digits =2),excessdeaths=round(sum(excessdeaths),digits =2),expectdeaths=sum(expectdeaths))

final_tab_regions_pandemia
write.csv2(final_tab_regions_pandemia, file = "final_tab_regions_pandemia.csv")



final_tab_regions_before <- before_russia_regions %>%
    group_by(VARNAME_1,Year ) %>%
    dplyr::summarise( 
      mean = round(mean(MR),digits =2),
    lci = round(t.test(MR, conf.level = 0.95)$conf.int[1],digits =2),
    uci =round( t.test(MR, conf.level = 0.95)$conf.int[2],digits =2),MR = sum(MR),
      All_case_deaths=sum(All_case_deaths),)
final_tab_regions_before
write.csv2(final_tab_regions_before, file = "final_tab_regions_before.csv")
```



```{r}
library(dplyr)
final_tab_Central_Federal_District_pandemia <- Central_Federal_District_pandemia%>%
   group_by(VARNAME_1,Year ) %>%
   dplyr::summarise(
    mean = round(mean(MR),digits =2),
    lci = round(t.test(MR, conf.level = 0.95)$conf.int[1],digits =2),
    uci =round( t.test(MR, conf.level = 0.95)$conf.int[2],digits =2),MR = sum(MR),All_case_deaths_max=max(All_case_deaths),All_case_deaths_min=min(All_case_deaths),All_case_deaths=sum(All_case_deaths),IR=round(sum(IR,na.rm=TRUE),digits =2),excessdeaths=round(sum(excessdeaths),digits =2),expectdeaths=sum(expectdeaths))

final_tab_Central_Federal_District_pandemia
write.csv2(final_tab_Central_Federal_District_pandemia, file = "final_tab_Central_Federal_District_pandemia.csv")



final_tab_Central_Federal_District_before <- Central_Federal_District_before%>%
    group_by(VARNAME_1,Year ) %>%
    dplyr::summarise( 
      mean = round(mean(MR),digits =2),
    lci = round(t.test(MR, conf.level = 0.95)$conf.int[1],digits =2),
    uci =round( t.test(MR, conf.level = 0.95)$conf.int[2],digits =2),MR = sum(MR),
      All_case_deaths=sum(All_case_deaths),)
final_tab_Central_Federal_District_before
write.csv2(final_tab_Central_Federal_District_before, file = "final_tab_Central_Federal_District_before.csv")
```

```{r}
map7<-ggplot(mapdata1, aes( x = `long`, y = `lat`, group=group)) +geom_polygon(aes(), color = "black")+
   geom_polygon( data = (mapdata1[mapdata1$id == "5",]), aes( x = `long`, y = `lat`, group=group), color = "red")+ 
   geom_polygon( data = (mapdata1[mapdata1$id == "16",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "24",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "29",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "36",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "43",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "50",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "51",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "54",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "62",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "85",]), aes( x = `long`, y = `lat`, group=group), color = "red")
map7

mapdata2 <- mapdata1 %>% 
  filter(id == 5 | id == 16| id ==24 | id ==29 | id ==36 | id ==43 | id ==50 | id ==51 | id ==54 | id ==62 | id ==85  )
map8<-ggplot(mapdata2, aes( x = `long`, y = `lat`, group=group)) +
  geom_polygon(aes(fill = DR2020), color = "black")+
   scale_fill_viridis_c(option = "plasma",direction = -1)+
    theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())+
  geom_polygon(aes(fill = DR2020), color = "black")
 #stat_midpoint(aes(label = NAME_1, group=group), geom = "text",size=3)
map8

mapdata2 <- mapdata1 %>% 
  filter(id == 5 | id == 16| id ==24 | id ==29 | id ==36 | id ==43 | id ==50 | id ==51 | id ==54 | id ==62 | id ==85  )
map9<-ggplot(mapdata2, aes( x = `long`, y = `lat`, group=group)) +
  geom_polygon(aes(fill = DR2021), color = "black")+
  scale_fill_viridis_c(option = "plasma",direction = -1)+
    theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())+
  geom_polygon(aes(fill = DR2021), color = "black")
 #stat_midpoint(aes(label = NAME_1, group=group), geom = "text",size=3)
map9

ggplot(mapdata2, aes(x = long, y = lat, group = group), height = 2500, width = 2500) + 
    geom_polygon(aes(fill = as.factor(...2))) + ggtitle("NORTH-WESTERN FEDERAL DISTRICT (NWFD) ") + 
    xlab("Longitude") + ylab("Latitude")
```

```{r}
library(dplyr)
final_tab_North_Western_Federal_District_pandemia <- North_Western_Federal_District_pandemia%>%
   group_by(VARNAME_1,Year) %>%
   dplyr::summarise(
    mean = round(mean(MR),digits =2),
    lci = round(t.test(MR, conf.level = 0.95)$conf.int[1],digits =2),
    uci =round( t.test(MR, conf.level = 0.95)$conf.int[2],digits =2),MR = sum(MR),All_case_deaths_max=max(All_case_deaths),All_case_deaths_min=min(All_case_deaths),All_case_deaths=sum(All_case_deaths),IR=round(sum(IR,na.rm=TRUE),digits =2),excessdeaths=round(sum(excessdeaths),digits =2),expectdeaths=sum(expectdeaths))

final_tab_North_Western_Federal_District_pandemia
write.csv2(final_tab_North_Western_Federal_District_pandemia, file = "final_tab_North_Western_Federal_District_pandemia.csv")

final_tab_North_Western_Federal_District_before <- North_Western_Federal_District_before%>%
   group_by(VARNAME_1,Year) %>%
   dplyr::summarise( 
      mean = round(mean(MR),digits =2),
    lci = round(t.test(MR, conf.level = 0.95)$conf.int[1],digits =2),
    uci =round( t.test(MR, conf.level = 0.95)$conf.int[2],digits =2),MR = sum(MR),
      All_case_deaths=sum(All_case_deaths),)
final_tab_North_Western_Federal_District_before
write.csv2(final_tab_North_Western_Federal_District_before, file = "final_tab_North_Western_Federal_District_before.csv")
```

```{r}
map10<-ggplot(mapdata1, aes( x = `long`, y = `lat`, group=group)) +geom_polygon(aes(), color = "black")+
   geom_polygon( data = (mapdata1[mapdata1$id == "1",]), aes( x = `long`, y = `lat`, group=group), color = "red")+ 
   geom_polygon( data = (mapdata1[mapdata1$id == "6",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "25",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "39",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "63",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "84",]), aes( x = `long`, y = `lat`, group=group), color = "red")
map10

mapdata2 <- mapdata1 %>% 
  filter(id == 1 | id == 6| id ==25 | id ==39 | id ==63 | id ==84)
map11<-ggplot(mapdata2, aes( x = `long`, y = `lat`, group=group)) +
  geom_polygon(aes(fill = DR2020), color = "black")+
  scale_fill_viridis_c(option = "plasma",direction = -1)+
    theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())+
  geom_polygon(aes(fill = DR2020), color = "black")
 #stat_midpoint(aes(label = NAME_1, group=group), geom = "text",size=3)
map11

mapdata2 <- mapdata1 %>% 
filter(id == 1 | id == 6| id ==25 | id ==39 | id ==63 | id ==84)

map12<-ggplot(mapdata2, aes( x = `long`, y = `lat`, group=group)) +
  geom_polygon(aes(fill = DR2021), color = "black")+
   scale_fill_viridis_c(option = "plasma",direction = -1)+
    theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())+
  geom_polygon(aes(fill = DR2021), color = "black")
 #stat_midpoint(aes(label = NAME_1, group=group), geom = "text",size=3)
map12

ggplot(mapdata2, aes(x = long, y = lat, group = group), height = 2500, width = 2500) + 
    geom_polygon(aes(fill = as.factor(...2))) + ggtitle("SOUTHERN FEDERAL DISTRICT (SOUTHERN FD)") + 
    xlab("Longitude") + ylab("Latitude")

```

```{r}
library(dplyr)
final_tab_Southern_Federal_District_pandemia <- Southern_Federal_District_pandemia%>%
   group_by(VARNAME_1,Year) %>%
   dplyr::summarise(
    mean = round(mean(MR),digits =2),
    lci = round(t.test(MR, conf.level = 0.95)$conf.int[1],digits =2),
    uci =round( t.test(MR, conf.level = 0.95)$conf.int[2],digits =2),MR = sum(MR),All_case_deaths_max=max(All_case_deaths),All_case_deaths_min=min(All_case_deaths),All_case_deaths=sum(All_case_deaths),IR=round(sum(IR,na.rm=TRUE),digits =2),excessdeaths=round(sum(excessdeaths),digits =2),expectdeaths=sum(expectdeaths))

final_tab_Southern_Federal_District_pandemia
write.csv2(final_tab_Southern_Federal_District_pandemia, file = "final_tab_Southern_Federal_District_pandemia.csv")


final_tab_Southern_Federal_District_before  <- Southern_Federal_District_before %>%
   group_by(VARNAME_1,Year) %>%
   dplyr::summarise( 
      mean = round(mean(MR),digits =2),
    lci = round(t.test(MR, conf.level = 0.95)$conf.int[1],digits =2),
    uci =round( t.test(MR, conf.level = 0.95)$conf.int[2],digits =2),MR = sum(MR),
      All_case_deaths=sum(All_case_deaths),)

final_tab_Southern_Federal_District_before
write.csv2(final_tab_Southern_Federal_District_before , file = "final_tab_Southern_Federal_District_before.csv")
```

```{r}
map13<-ggplot(mapdata1, aes( x = `long`, y = `lat`, group=group)) +geom_polygon(aes(), color = "black")+
   geom_polygon( data = (mapdata1[mapdata1$id == "17",]), aes( x = `long`, y = `lat`, group=group), color = "red")+ 
   geom_polygon( data = (mapdata1[mapdata1$id == "11",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "20",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "23",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "28",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "53",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "70",]), aes( x = `long`, y = `lat`, group=group), color = "red")
map13
mapdata2 <- mapdata1 %>% 
  filter(id == 17 | id == 11| id ==20 | id ==23 | id ==28 | id ==53 | id ==70 )
map14<-ggplot(mapdata2, aes( x = `long`, y = `lat`, group=group)) +
  geom_polygon(aes(fill = DR2020), color = "black")+
  scale_fill_viridis_c(option = "plasma",direction = -1)+
    theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())+
  geom_polygon(aes(fill = DR2020), color = "black")
 #stat_midpoint(aes(label = NAME_1, group=group), geom = "text",size=3)
map14
mapdata2 <- mapdata1 %>% 
 filter(id == 17 | id == 11| id ==20 | id ==23 | id ==28 | id ==53 | id ==70 )

map15<-ggplot(mapdata2, aes( x = `long`, y = `lat`, group=group)) +
  geom_polygon(aes(fill = DR2021), color = "black")+
   scale_fill_viridis_c(option = "plasma",direction = -1)+
    theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())+
  geom_polygon(aes(fill = DR2021), color = "black")
 #stat_midpoint(aes(label = NAME_1, group=group), geom = "text",size=3)
map15

ggplot(mapdata2, aes(x = long, y = lat, group = group), height = 2500, width = 2500) + 
    geom_polygon(aes(fill = as.factor(...2))) + ggtitle("NORTH CAUCASUS FEDERAL DISTRICT (NCFD)") + 
    xlab("Longitude") + ylab("Latitude")


```


```{r}
library(dplyr)
final_tab_North_Caucasus_Federal_District_pandemia <- North_Caucasus_Federal_District_pandemia%>%
   group_by(VARNAME_1,Year ) %>%
   dplyr::summarise(
    mean = round(mean(MR),digits =2),
    lci = round(t.test(MR, conf.level = 0.95)$conf.int[1],digits =2),
    uci =round( t.test(MR, conf.level = 0.95)$conf.int[2],digits =2),MR = sum(MR),All_case_deaths_max=max(All_case_deaths),All_case_deaths_min=min(All_case_deaths),All_case_deaths=sum(All_case_deaths),IR=round(sum(IR,na.rm=TRUE),digits =2),excessdeaths=round(sum(excessdeaths),digits =2),expectdeaths=sum(expectdeaths))

final_tab_North_Caucasus_Federal_District_pandemia

write.csv2(final_tab_North_Caucasus_Federal_District_pandemia, file = "final_tab_North_Caucasus_Federal_District_pandemia.csv")

final_tab_North_Caucasus_Federal_District_before <- North_Caucasus_Federal_District_before%>%
   group_by(VARNAME_1,Year) %>%
   dplyr::summarise( 
      mean = round(mean(MR),digits =2),
    lci = round(t.test(MR, conf.level = 0.95)$conf.int[1],digits =2),
    uci =round( t.test(MR, conf.level = 0.95)$conf.int[2],digits =2),MR = sum(MR),
      All_case_deaths=sum(All_case_deaths),)
final_tab_North_Caucasus_Federal_District_before
write.csv2(final_tab_North_Caucasus_Federal_District_before, file = "final_tab_North_Caucasus_Federal_District_before.csv")
```

```{r}

map16<-ggplot(mapdata1, aes( x = `long`, y = `lat`, group=group)) +geom_polygon(aes(), color = "black")+
   geom_polygon( data = (mapdata1[mapdata1$id == "7",]), aes( x = `long`, y = `lat`, group=group), color = "red")+ 
   geom_polygon( data = (mapdata1[mapdata1$id == "15",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "34",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "35",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "46",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "47",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "52",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "58",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "59",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "60",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "67",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "68",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "73",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "80",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "81",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "93",]), aes( x = `long`, y = `lat`, group=group), color = "red")
map16

mapdata2 <- mapdata1 %>% 
  filter(id == 7 | id == 15| id ==34 | id ==35 | id ==46 | id ==47 | id ==52 | id ==58 | id ==59 | id ==60 | id ==67 |id ==73 | id ==80 |id == 81| id ==91  )
map17<-ggplot(mapdata2, aes( x = `long`, y = `lat`, group=group)) +
  geom_polygon(aes(fill = DR2020), color = "black")+
   scale_fill_viridis_c(option = "plasma",direction = -1)+
    theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())+
  geom_polygon(aes(fill = DR2020), color = "black")
 #stat_midpoint(aes(label = NAME_1, group=group), geom = "text",size=3)
map17

mapdata2 <- mapdata1 %>% 
 filter(id == 7 | id == 15| id ==34 | id ==35 | id ==46 | id ==47 | id ==52 | id ==58 | id ==59 | id ==60 | id ==67 |id ==73 | id ==80 |id == 81| id ==91  )

map18<-ggplot(mapdata2, aes( x = `long`, y = `lat`, group=group)) +
  geom_polygon(aes(fill = DR2021), color = "black")+
  scale_fill_viridis_c(option = "plasma",direction = -1)+
    theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())+
  geom_polygon(aes(fill = DR2021), color = "black")
 #stat_midpoint(aes(label = NAME_1, group=group), geom = "text",size=3)
map18

ggplot(mapdata2, aes(x = long, y = lat, group = group), height = 2500, width = 2500) + 
    geom_polygon(aes(fill = as.factor(...2))) + ggtitle("VOLGA FEDERAL DISTRICT (VFD)") + 
    xlab("Longitude") + ylab("Latitude")

```

```{r}
library(dplyr)
final_tab_Volga_Federal_District_pandemia <- Volga_Federal_District_pandemia%>%
   group_by(VARNAME_1,Year) %>%
   dplyr::summarise(
    mean = round(mean(MR),digits =2),
    lci = round(t.test(MR, conf.level = 0.95)$conf.int[1],digits =2),
    uci =round( t.test(MR, conf.level = 0.95)$conf.int[2],digits =2),MR = sum(MR),All_case_deaths_max=max(All_case_deaths),All_case_deaths_min=min(All_case_deaths),All_case_deaths=sum(All_case_deaths),IR=round(sum(IR,na.rm=TRUE),digits =2),excessdeaths=round(sum(excessdeaths),digits =2),expectdeaths=sum(expectdeaths))

final_tab_Volga_Federal_District_pandemia

write.csv2(final_tab_Volga_Federal_District_pandemia, file = "final_tab_Volga_Federal_District_pandemia.csv")

final_tab_Volga_Federal_District_before <- Volga_Federal_District_before%>%
   group_by(VARNAME_1,Year) %>%
   dplyr::summarise( 
      mean = round(mean(MR),digits =2),
    lci = round(t.test(MR, conf.level = 0.95)$conf.int[1],digits =2),
    uci =round( t.test(MR, conf.level = 0.95)$conf.int[2],digits =2),MR = sum(MR),
      All_case_deaths=sum(All_case_deaths),)
final_tab_Volga_Federal_District_before
write.csv2(final_tab_Volga_Federal_District_before, file = "final_tab_Volga_Federal_District_before.csv")
```



```{r}
map19<-ggplot(mapdata1, aes( x = `long`, y = `lat`, group=group)) +geom_polygon(aes(), color = "black")+
   geom_polygon( data = (mapdata1[mapdata1$id == "12",]), aes( x = `long`, y = `lat`, group=group), color = "red")+ 
   geom_polygon( data = (mapdata1[mapdata1$id == "33",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "41",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "71",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "79",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "87",]), aes( x = `long`, y = `lat`, group=group), color = "red")
map19


mapdata2 <- mapdata1 %>% 
  filter(id == 12 | id == 33|id ==41 |id == 71| id ==79 | id ==87 )
map20<-ggplot(mapdata2, aes( x = `long`, y = `lat`, group=group)) +
  geom_polygon(aes(fill = DR2020), color = "black")+
  scale_fill_viridis_c(option = "plasma",direction = -1)+
    theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())+
  geom_polygon(aes(fill = DR2020), color = "black")
 #stat_midpoint(aes(label = NAME_1, group=group), geom = "text",size=3)
map20

mapdata2 <- mapdata1 %>% 
  filter(id == 12 | id == 33|id ==41 |id == 71| id ==79 | id ==87 )

map21<-ggplot(mapdata2, aes( x = `long`, y = `lat`, group=group)) +
  geom_polygon(aes(fill = DR2021), color = "black")+
   scale_fill_viridis_c(option = "plasma",direction = -1)+
    theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())+
  geom_polygon(aes(fill = DR2021), color = "black")
 #stat_midpoint(aes(label = NAME_1, group=group), geom = "text",size=3)
map21

ggplot(mapdata2, aes(x = long, y = lat, group = group), height = 2500, width = 2500) + 
    geom_polygon(aes(fill = as.factor(...2))) + ggtitle("URAL Federal DISTRICT (UFA) ") + 
    xlab("Longitude") + ylab("Latitude")

```

```{r}
library(dplyr)
final_tab_Ural_Federal_District_pandemia <- Ural_Federal_District_pandemia%>%
   group_by(VARNAME_1,Year) %>%
   dplyr::summarise(
    mean = round(mean(MR),digits =2),
    lci = round(t.test(MR, conf.level = 0.95)$conf.int[1],digits =2),
    uci =round( t.test(MR, conf.level = 0.95)$conf.int[2],digits =2),MR = sum(MR),All_case_deaths_max=max(All_case_deaths),All_case_deaths_min=min(All_case_deaths),All_case_deaths=sum(All_case_deaths),IR=round(sum(IR,na.rm=TRUE),digits =2),excessdeaths=round(sum(excessdeaths),digits =2),expectdeaths=sum(expectdeaths))

final_tab_Ural_Federal_District_pandemia
write.csv2(final_tab_Ural_Federal_District_pandemia, file = "final_tab_Ural_Federal_District_pandemia.csv")

final_tab_Ural_Federal_District_before<- Ural_Federal_District_before%>%
   group_by(VARNAME_1,Year) %>%
   dplyr::summarise( 
      mean = round(mean(MR),digits =2),
    lci = round(t.test(MR, conf.level = 0.95)$conf.int[1],digits =2),
    uci =round( t.test(MR, conf.level = 0.95)$conf.int[2],digits =2),MR = sum(MR),
      All_case_deaths=sum(All_case_deaths),)
final_tab_Ural_Federal_District_before
write.csv2(final_tab_Ural_Federal_District_before, file = "final_tab_Ural_Federal_District_before.csv")
```

```{r}
map22<-ggplot(mapdata1, aes( x = `long`, y = `lat`, group=group)) +geom_polygon(aes(), color = "black")+
   geom_polygon( data = (mapdata1[mapdata1$id == "3",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "18",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "19",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "21",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "30",]), aes( x = `long`, y = `lat`, group=group), color = "red")+ 
   geom_polygon( data = (mapdata1[mapdata1$id == "32",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "40",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "55",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "56",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "74",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "75",]), aes( x = `long`, y = `lat`, group=group), color = "red")+ 
   geom_polygon( data = (mapdata1[mapdata1$id == "77",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "82",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "94",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "95",]), aes( x = `long`, y = `lat`, group=group), color = "red")
map22


mapdata2 <- mapdata1 %>% 
  filter( id == 3|id == 18| id ==19 | id ==21 | id ==30 | id ==32 | id == 40 | id == 55| id ==56 | id ==74 | id ==75 | id ==77| id==82 | id == 94| id ==95)
map23<-ggplot(mapdata2, aes( x = `long`, y = `lat`, group=group)) +
  geom_polygon(aes(fill = DR2020), color = "black")+
   scale_fill_viridis_c(option = "plasma",direction = -1)+
    theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())+
  geom_polygon(aes(fill = DR2020), color = "black")
 #stat_midpoint(aes(label = NAME_1, group=group), geom = "text",size=3)
map23

mapdata2 <- mapdata1 %>% 
 filter( id == 3 |id == 18| id ==19 | id ==21 | id ==30 | id ==32 | id == 40 | id == 55| id ==56 | id ==74 | id ==75 | id ==77| id==82 | id == 94| id ==95)

map24<-ggplot(mapdata2, aes( x = `long`, y = `lat`, group=group)) +
  geom_polygon(aes(fill = DR2021), color = "black")+
   scale_fill_viridis_c(option = "plasma",direction = -1)+
    theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())+
  geom_polygon(aes(fill = DR2021), color = "black")
 #stat_midpoint(aes(label = NAME_1, group=group), geom = "text",size=3)
map24

ggplot(mapdata2, aes(x = long, y = lat, group = group), height = 2500, width = 2500) + 
    geom_polygon(aes(fill = as.factor(...2))) + ggtitle("SIBERIAN FEDERAL DISTRICT (SIBERIAN FD)") + 
    xlab("Longitude") + ylab("Latitude")

```


```{r}
library(dplyr)
final_tab_Siberian_Federal_District_pandemia <- Siberian_Federal_District_pandemia%>%
   group_by(VARNAME_1,Year) %>%
   dplyr::summarise(
    mean = round(mean(MR),digits =2),
    lci = round(t.test(MR, conf.level = 0.95)$conf.int[1],digits =2),
    uci =round( t.test(MR, conf.level = 0.95)$conf.int[2],digits =2),MR = sum(MR),All_case_deaths_max=max(All_case_deaths),All_case_deaths_min=min(All_case_deaths),All_case_deaths=sum(All_case_deaths),IR=round(sum(IR,na.rm=TRUE),digits =2),excessdeaths=round(sum(excessdeaths),digits =2),expectdeaths=sum(expectdeaths))

final_tab_Siberian_Federal_District_pandemia
write.csv2(final_tab_Siberian_Federal_District_pandemia, file = "final_tab_Siberian_Federal_District_pandemia.csv")

final_tab_Siberian_Federal_District_before <- Siberian_Federal_District_before%>%
   group_by(VARNAME_1,Year ) %>%
   dplyr::summarise( 
      mean = round(mean(MR),digits =2),
    lci = round(t.test(MR, conf.level = 0.95)$conf.int[1],digits =2),
    uci =round( t.test(MR, conf.level = 0.95)$conf.int[2],digits =2),MR = sum(MR),
      All_case_deaths=sum(All_case_deaths),)
final_tab_Siberian_Federal_District_before
write.csv2(final_tab_Siberian_Federal_District_before, file = "final_tab_Siberian_Federal_District_before.csv")
```

```{r}
map25<-ggplot(mapdata1, aes( x = `long`, y = `lat`, group=group)) +geom_polygon(aes(), color = "black")+
   geom_polygon( data = (mapdata1[mapdata1$id == "4",]), aes( x = `long`, y = `lat`, group=group), color = "red")+ 
   geom_polygon( data = (mapdata1[mapdata1$id == "10",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "14",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "27",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "31",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "37",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "45",]), aes( x = `long`, y = `lat`, group=group), color = "red")+ 
   geom_polygon( data = (mapdata1[mapdata1$id == "61",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "65",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "66",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "89",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "91",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
   geom_polygon( data = (mapdata1[mapdata1$id == "92",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
  geom_polygon( data = (mapdata1[mapdata1$id == "13",]), aes( x = `long`, y = `lat`, group=group), color = "red")+
geom_polygon( data = (mapdata1[mapdata1$id == "2",]), aes( x = `long`, y = `lat`, group=group), color = "red")
map25
mapdata2 <- mapdata1 %>% 
  filter(id == 2 |id == 4 | id == 10|id ==14 |id == 27| id ==31 |id == 37| id ==45 |id == 61|id == 65| id == 66|id==66|id==89|id==91|id==92|id ==13 )
map26<-ggplot(mapdata2, aes( x = `long`, y = `lat`, group=group)) +
  geom_polygon(aes(fill = DR2021), color = "black")+
   scale_fill_viridis_c(option = "plasma",direction = -1)+
    theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())+
  geom_polygon(aes(fill = DR2021), color = "black")
 #stat_midpoint(aes(label = NAME_1, group=group), geom = "text",size=3)
map26
mapdata2 <- mapdata1 %>% 
   filter(id == 2 |id == 4 | id == 10|id ==14 |id == 27| id ==31 |id == 37| id ==45 |id == 61|id == 65| id == 66|id==66|id==89|id==91|id==92|id ==13 )

map27<-ggplot(mapdata2, aes( x = `long`, y = `lat`, group=group)) +
  geom_polygon(aes(fill = DR2021), color = "black")+
   scale_fill_viridis_c(option = "plasma",direction = -1)+
    theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.y=element_blank(),
        axis.title.x=element_blank(),
        rect = element_blank())+
  geom_polygon(aes(fill = DR2021), color = "black")
 #stat_midpoint(aes(label = NAME_1, group=group), geom = "text",size=3)
map27
ggplot(mapdata2, aes(x = long, y = lat, group = group), height = 2500, width = 2500) + 
    geom_polygon(aes(fill = as.factor(...2))) + ggtitle("FAR EASTERN FEDERAL DISTRICT (FEFD)") + 
    xlab("Longitude") + ylab("Latitude")

```



```{r}
library(dplyr)
final_tab_Far_Eastern_Federal_District_pandemia <- Far_Eastern_Federal_District_pandemia%>%
   group_by(VARNAME_1,Year) %>%
   dplyr::summarise(
    mean = round(mean(MR),digits =2),
    lci = round(t.test(MR, conf.level = 0.95)$conf.int[1],digits =2),
    uci =round( t.test(MR, conf.level = 0.95)$conf.int[2],digits =2),MR = sum(MR),All_case_deaths_max=max(All_case_deaths),All_case_deaths_min=min(All_case_deaths),All_case_deaths=sum(All_case_deaths),IR=round(sum(IR,na.rm=TRUE),digits =2),excessdeaths=round(sum(excessdeaths),digits =2),expectdeaths=sum(expectdeaths))

final_tab_Far_Eastern_Federal_District_pandemia
write.csv2(final_tab_Far_Eastern_Federal_District_pandemia, file = "final_tab_Far_Eastern_Federal_District_pandemia.csv")

final_tab_Far_Eastern_Federal_District_before  <- Far_Eastern_Federal_District_before %>%
   group_by(VARNAME_1,Year) %>%
   dplyr::summarise( 
      mean = round(mean(MR),digits =2),
    lci = round(t.test(MR, conf.level = 0.95)$conf.int[1],digits =2),
    uci =round( t.test(MR, conf.level = 0.95)$conf.int[2],digits =2),MR = sum(MR),
      All_case_deaths=sum(All_case_deaths),)
final_tab_Far_Eastern_Federal_District_before
write.csv2(final_tab_Far_Eastern_Federal_District_before , file = "final_tab_Far_Eastern_Federal_District_before .csv")
```

#The final part is the creation of graphs for each region, county and country, the code includes part of the Malcolm Barrett code and the appearance of the newspaper Time

```{r}
setwd("C:/Users/AVGUST/Desktop/R_ regions/2020new")
#setwd("C:/Users/AVGUST/Desktop/R_ regions/2020")
library('dplyr')
plot_region <- function(x = "1"){
  tmp <- before_russia_regions %>%
    filter(VARNAME_1 == x)
    p <- ggplot(tmp, aes(x = week ,y = All_case_deaths ,group = Year))+
    geom_line(color = "grey75", alpha = 0.6)+
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates historical averages",
    subtitle = "Number of deaths per weeks from all causes in 2020")+
  geom_line(
    data = pandemia_russia_regions2020 %>% 
      filter(VARNAME_1 == x),
    color = "firebrick"
  )+geom_ribbon(
    data = pandemia_russia_regions2020 %>% 
      filter(VARNAME_1 == x),
    aes(ymin = pmin(expectdeaths, All_case_deaths), ymax = All_case_deaths, 
    ), 
    fill = "tomato", 
    alpha = 0.5
  )+geom_line(
    data = pandemia_russia_regions2020 %>% 
      filter(VARNAME_1 == x),aes(
    color = "All_case_deaths")
  )+
  geom_line(
    data = pandemia_russia_regions2020 %>% 
      filter(VARNAME_1 == x),
    aes(x = week,y = expectdeaths,
    color = "Expect_deaths"),
    inherit.aes = FALSE 
  )+
     scale_color_manual(name = "Y series", values = c("All_case_deaths" = "blue", "Expect_deaths" = "black","Excess_deaths" = "tomato", "Past_Years" = "grey75"))+
     ft_theme()+theme_classic()+theme(legend.position = "bottom")
  
   
   
  ggsave(p,file = paste0(x,".pdf"),dpi = 300,limitsize = FALSE)
  }
for (k in unique(before_russia_regions$VARNAME_1)) {
  plot_region(k)
}
```


```{r}
setwd("C:/Users/AVGUST/Desktop/R_ regions/2021new")
#setwd("C:/Users/AVGUST/Desktop/R_ regions/2021")
plot_region <- function(x = "1"){
  tmp <- pandemia_russia_regions2020_before_russia %>% 
    filter(VARNAME_1 == x)
   p <- ggplot(tmp, aes(x = week ,y = All_case_deaths ,group = Year))+
    geom_line(color = "grey75", alpha = 0.6)+
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates historical averages",
    subtitle = "Number of deaths per weeks from all causes in 2021")+
  geom_line(
    data = pandemia_russia_regions2021 %>% 
      filter(VARNAME_1 == x),
    color = "firebrick"
  )+geom_ribbon(
    data = pandemia_russia_regions2021 %>% 
      filter(VARNAME_1 == x),
    aes(ymin = pmin(expectdeaths, All_case_deaths), ymax = All_case_deaths, 
    ), 
    fill = "tomato", 
    alpha = 0.5
  )+geom_line(
    data = pandemia_russia_regions2021 %>% 
      filter(VARNAME_1 == x),aes(
    color = "All_case_deaths")
  )+
  geom_line(
    data = pandemia_russia_regions2021 %>% 
      filter(VARNAME_1 == x),
    aes(x = week,y = expectdeaths,
    color = "Expect_deaths"),
    inherit.aes = FALSE 
  )+
     scale_color_manual(name = "Y series", values = c("All_case_deaths" = "blue", "Expect_deaths" = "black","Excess_deaths" = "tomato", "Past_Year" = "grey75"))+
   ft_theme()+theme_classic()+theme(legend.position = "bottom")
  ggsave(p,file = paste0(x,".pdf"),dpi = 300,limitsize = FALSE)
  }
for (k in unique(pandemia_russia_regions2020_before_russia$VARNAME_1)) {
  plot_region(k)
}
```

```{r}
setwd("C:/Users/AVGUST/Desktop/R_ regions/all_new")
#setwd("C:/Users/AVGUST/Desktop/R_ regions/All")
plot_region <- function(x = "1"){
  al <- before_russia_regions %>% 
    filter(VARNAME_1 == x)
    z <- ggplot(al, aes(x = week ,y = All_case_deaths ,group = Year)
) +
  geom_line(color = "black", alpha = 0.6)+
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates in Russia historical averages",
    subtitle = "Number of deaths per weeks from all causes"
  )+
  geom_smooth(formula = y ~ x, method = "loess",col='red', size=1)+
  facet_wrap(vars(Year), scales = "free_y")+
  ft_theme()+theme_classic()+theme(legend.position = "bottom")
    ggsave(z,file = paste0(x,".pdf"),dpi = 300,limitsize = FALSE)
}
for (k in unique(before_russia_regions$VARNAME_1)) {
  plot_region(k)
}  

```

```{r}
setwd("C:/Users/AVGUST/Desktop/2020")
library('dplyr')
plot_region <- function(x = "1"){
  tmp <- before_russia_district %>% 
    filter(VARNAME_1 == x)
   p <- ggplot(tmp, aes(x = week ,y = All_case_deaths ,group = Year))+
    geom_line(color = "grey75", alpha = 0.6)+
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates historical averages",
    subtitle = "Number of deaths per weeks from all causes in 2020")+
  geom_line(
    data = pandemia_russia_district2020 %>% 
      filter(VARNAME_1 == x),
    color = "firebrick"
  )+geom_ribbon(
    data = pandemia_russia_district2020 %>% 
      filter(VARNAME_1 == x),
    aes(ymin = pmin(expectdeaths, All_case_deaths), ymax = All_case_deaths, 
    ), 
    fill = "tomato", 
    alpha = 0.5
  )+geom_line(
    data = pandemia_russia_district2020 %>% 
      filter(VARNAME_1 == x),aes(
    color = "All_case_deaths")
  )+
  geom_line(
    data = pandemia_russia_district2020 %>% 
      filter(VARNAME_1 == x),
    aes(x = week,y = expectdeaths,
    color = "Expect_deaths"),
    inherit.aes = FALSE 
  )+
     scale_color_manual(name = "Y series", values = c("All_case_deaths" = "blue", "Expect_deaths" = "black","Excess_deaths" = "tomato", "Past_Years" = "grey75"))+
     
     ft_theme()+theme_classic()+theme(legend.position = "bottom")
  
   
   
  ggsave(p,file = paste0(x,".pdf"),dpi = 300,limitsize = FALSE)
  }
for (k in unique(before_russia_district$VARNAME_1)) {
  plot_region(k)
}
```


```{r}
setwd("C:/Users/AVGUST/Desktop/2021")
plot_region <- function(x = "1"){
  tmp <- pandemia_russia_district2020_before_russia %>% 
    filter(VARNAME_1 == x)
   p <- ggplot(tmp, aes(x = week ,y = All_case_deaths ,group = Year))+
    geom_line(color = "grey75", alpha = 0.6)+
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates historical averages",
    subtitle = "Number of deaths per weeks from all causes 2021")+
  geom_line(
    data = pandemia_russia_district2021 %>% 
      filter(VARNAME_1 == x),
    color = "firebrick"
  )+geom_ribbon(
    data = pandemia_russia_district2021 %>% 
      filter(VARNAME_1 == x),
    aes(ymin = pmin(expectdeaths, All_case_deaths), ymax = All_case_deaths, 
    ), 
    fill = "tomato", 
    alpha = 0.5
  )+geom_line(
    data = pandemia_russia_district2021 %>% 
      filter(VARNAME_1 == x),aes(
    color = "All_case_deaths")
  )+
  geom_line(
    data = pandemia_russia_district2021 %>% 
      filter(VARNAME_1 == x),
    aes(x = week,y = expectdeaths,
    color = "Expect_deaths"),
    inherit.aes = FALSE 
  )+
     scale_color_manual(name = "Y series", values = c("All_case_deaths" = "blue", "Expect_deaths" = "black","Excess_deaths" = "tomato", "Past_Year" = "grey75"))+
   ft_theme()+theme_classic()+theme(legend.position = "bottom")
  ggsave(p,file = paste0(x,".pdf"),dpi = 300,limitsize = FALSE)
  }
for (k in unique(pandemia_russia_district2020_before_russia$VARNAME_1)) {
  plot_region(k)
}
```

```{r}
setwd("C:/Users/AVGUST/Desktop/R_ regions/all_district")
plot_region <- function(x = "1"){
  al <- before_russia_district %>% 
    filter(VARNAME_1 == x)
    z <- ggplot(al, aes(x = week ,y = All_case_deaths ,group = Year)
) +
  geom_line(color = "black", alpha = 0.6)+
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates in Russia historical averages",
    subtitle = "Number of deaths per weeks from all causes"
  )+
  geom_smooth(formula = y ~ x, method = "loess",col='red', size=1)+
  facet_wrap(vars(Year), scales = "free_y")+
  ft_theme()+theme_classic()+theme(legend.position = "bottom")
    ggsave(z,file = paste0(x,".pdf"),dpi = 300,limitsize = FALSE)
}
for (k in unique(before_russia_district$VARNAME_1)) {
  plot_region(k)
}  

```


```{r , echo=FALSE}
gg_2020 <- ggplot(
  before_russia_all,  aes(x = week ,y = All_case_deaths ,group = Year)
) +
  geom_line(color = "grey75", alpha = 0.6)+
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates in Russia compared to historical averages",
    subtitle = "Number of deaths per weeks from all causes in 2020"
  )+
  geom_line(
    data = pandemia_russia_all2020,
    color = "firebrick"
  )+geom_ribbon(
    data = pandemia_russia_all2020,
    aes(ymin = pmin(expectdeaths, All_case_deaths), ymax = All_case_deaths, 
), 
    fill = "tomato", 
    alpha = 0.5
    )+geom_line(
    data = pandemia_russia_all2020,
    color = "blue"
  )+
  geom_line(
    data = pandemia_russia_all2020,
    aes(x = week,y = expectdeaths ),
    color = "black",
    inherit.aes = FALSE 
    )+
    annotate(
    "text",
    x = 20,
    y = 200000,
    label = "\npast years\ndeaths",
    color = "grey60")+
    annotate(
    "text",
    x = 25,
    y = 220000,
    label = "422079\nexcess\ndeaths\n(+24,8%)",
    color = "firebrick")+
  annotate(
    "text",
    x = 10,
    y = 220000,
    label = "1702400\nexpect\ndeaths",
    color = "black")+
  annotate(
    "text",
    x = 40,
    y = 220000,
    label = "2124479\nobserved\ndeaths\n2020",
    color = "blue")+
  annotate(
    "segment",
    x = 26,
    xend = 24,
    y = 215000,
    yend = 160000,
    arrow = arrow(length = unit(0.3, "cm")),
    color = "firebrick"
    )+
  annotate(
    "segment",
    x = 10,
    xend = 10,
    y = 215000,
    yend = 140000,
    arrow = arrow(length = unit(0.3, "cm")),
    color = "black"
    )+
  annotate(
    "segment",
    x = 40,
    xend = 43,
    y = 215000,
    yend = 200000,
    arrow = arrow(length = unit(0.3, "cm")),
    color = "blue"
    )+
  annotate(
    "segment",
    x = 20,
    xend = 15,
    y = 195000,
    yend = 180000,
    arrow = arrow(length = unit(0.3, "cm")),
    color = "grey60"
    )
gg_2020

pdf(file = "Fig1.pdf")
gg_2020
dev.off()
```


```{r}
gg_2021 <- ggplot(
  pandemia_russia_all2020_before_russia,  aes(x = week ,y = All_case_deaths ,group = Year)
) +
  geom_line(color = "grey75", alpha = 0.8)+
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates in Russia compared to historical averages",
    subtitle = "Number of deaths per weeks from all causes  in 2021"
  ) +
  geom_line(
    data = pandemia_russia_all2021,
    color = "firebrick"
  )+geom_ribbon(
    data = pandemia_russia_all2021,
    aes(ymin = pmin(expectdeaths, All_case_deaths), ymax = All_case_deaths, 
), 
    fill = "tomato", 
    alpha = 0.5
    )+
  geom_line(
    data = pandemia_russia_all2021,
    color = "blue"
  )+
  geom_line(
    data = pandemia_russia_all2021,
    aes(x = week,y = expectdeaths ),
    color = "black",
    inherit.aes = FALSE 
    )+
    annotate(
    "text",
    x = 20,
    y = 220000,
    label = "2124479\npast year\ndeaths",
    color = "grey60")+
    annotate(
    "text",
    x = 25,
    y = 240000,
    label = "755407\nexcess\ndeaths\n(+44,7%)",
    color = "firebrick")+
  annotate(
    "text",
    x = 10,
    y = 240000,
    label = "1690102\nexpect\ndeaths",
    color = "black")+
  annotate(
    "text",
    x = 40,
    y = 240000,
    label = "2445509\nobserved\ndeaths\n2021",
    color = "blue")+
  annotate(
    "segment",
    x = 24,
    xend = 24,
    y = 225000,
    yend = 160000,
    arrow = arrow(length = unit(0.3, "cm")),
    color = "firebrick"
    )+
  annotate(
    "segment",
    x = 10,
    xend = 10,
    y = 225000,
    yend = 145000,
    arrow = arrow(length = unit(0.3, "cm")),
    color = "black"
    )+
  annotate(
    "segment",
    x = 41,
    xend = 35,
    y = 225000,
    yend = 210000,
    arrow = arrow(length = unit(0.3, "cm")),
    color = "blue"
    )+
  annotate(
    "segment",
    x = 20,
    xend = 21,
    y = 210000,
    yend = 167755,
    arrow = arrow(length = unit(0.3, "cm")),
    color = "grey60"
    )
gg_2021

pdf(file = "Fig2.pdf")
gg_2021
dev.off()


```

```{r}
gg_all <- ggplot(
  before_russia_all,  aes(x = week ,y = All_case_deaths ,group = Year)
) +
  geom_line(color = "black", alpha = 0.6)+
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates in Russia historical averages",
    subtitle = "Number of deaths per weeks from all causes"
  )+
  geom_smooth(formula = y ~ x, method = "loess",col='red', size=1)+
  facet_wrap(vars(Year), scales = "free_y")

gg_all

pdf(file = "Fig3.pdf")
gg_all
dev.off()
```


```{r}

Central_Federal_District_pandemia2020 <- Central_Federal_District_pandemia %>% 
  filter( Year == 2020)

Central_Federal_District_pandemia2021 <- Central_Federal_District_pandemia %>% 
  filter( Year == 2021)

gg_Central_Federal_District2020 <- ggplot(
  Central_Federal_District_before,  aes(x = week ,y = All_case_deaths ,group = Year)
) +
  geom_line(color = "grey75", alpha = 0.8)+
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates in Russia compared to historical averages",
    subtitle = "Number of deaths per weeks from all causes  vs. 2021"
  ) +
  geom_line(
    data = Central_Federal_District_pandemia2020,
    color = "firebrick"
  )+geom_ribbon(
    data = Central_Federal_District_pandemia2020,
    aes(ymin = pmin(expectdeaths, All_case_deaths), ymax = All_case_deaths, 
), 
    fill = "tomato", 
    alpha = 0.5
    )+
  geom_line(
    data = Central_Federal_District_pandemia2020,
    color = "blue"
  )+
  geom_line(
    data = Central_Federal_District_pandemia2020,
    aes(x = week,y = expectdeaths ),
    color = "black",
    inherit.aes = FALSE 
    )+
    facet_wrap(vars(VARNAME_1), scales = "free_y") +
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates compared to historical averages",
    subtitle = "Number of deaths per week from all causes 2020  vs. recent years"
    )+ft_theme()


   ft_theme()
gg_Central_Federal_District2021 <- ggplot(
  Central_Federal_District_before,  aes(x = week ,y = All_case_deaths ,group = Year)
) +
  geom_line(color = "grey75", alpha = 0.8)+
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates in Russia compared to historical averages",
    subtitle = "Number of deaths per weeks from all causes  vs. 2021"
  ) +
  geom_line(
    data = Central_Federal_District_pandemia2021,
    color = "firebrick"
  )+geom_ribbon(
    data = Central_Federal_District_pandemia2021,
    aes(ymin = pmin(expectdeaths, All_case_deaths), ymax = All_case_deaths, 
), 
    fill = "tomato", 
    alpha = 0.5
    )+
  geom_line(
    data = Central_Federal_District_pandemia2021,
    color = "blue"
  )+
  geom_line(
    data = Central_Federal_District_pandemia2021,
    aes(x = week,y = expectdeaths ),
    color = "black",
    inherit.aes = FALSE 
    )+
    facet_wrap(vars(VARNAME_1), scales = "free_y") +
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates compared to historical averages",
    subtitle = "Number of deaths per week from all causes 2021 vs. recent years"
    )+ ft_theme()







 gg_Central_Federal_District2020
 gg_Central_Federal_District2021
 
 
jpeg(file = "Central_Federal_District2020.jpg", quality = 100, width = 1000, height = 1000) 
#pdf(file = "Central_Federal_District2020.pdf")
gg_Central_Federal_District2020
dev.off()

jpeg(file = "Central_Federal_District2021.jpg", quality = 100, width = 1000, height = 1000) 
gg_Central_Federal_District2021
dev.off() 


```

```{r}

North_Western_Federal_District_pandemia2020 <- North_Western_Federal_District_pandemia %>% 
  filter( Year == 2020)

North_Western_Federal_District_pandemia2021 <- North_Western_Federal_District_pandemia %>% 
  filter( Year == 2021)
gg_North_Western_Federal_District2020 <- ggplot(
  North_Western_Federal_District_before,  aes(x = week ,y = All_case_deaths ,group = Year)
) +
  geom_line(color = "grey75", alpha = 0.8)+
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates in Russia compared to historical averages",
    subtitle = "Number of deaths per weeks from all causes  vs. 2020"
  ) +
  geom_line(
    data = North_Western_Federal_District_pandemia2020,
    color = "firebrick"
  )+geom_ribbon(
    data = North_Western_Federal_District_pandemia2020,
    aes(ymin = pmin(expectdeaths, All_case_deaths), ymax = All_case_deaths, 
), 
    fill = "tomato", 
    alpha = 0.5
    )+
  geom_line(
    data = North_Western_Federal_District_pandemia2020,
    color = "blue"
  )+
  geom_line(
    data = North_Western_Federal_District_pandemia2020,
    aes(x = week,y = expectdeaths ),
    color = "black",
    inherit.aes = FALSE 
    )+
    facet_wrap(vars(VARNAME_1), scales = "free_y") +
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates compared to historical averages",
    subtitle = "Number of deaths per week from all causes 2020  vs. recent years"
    )+
 ft_theme()

gg_North_Western_Federal_District2021 <- ggplot(
  North_Western_Federal_District_before,  aes(x = week ,y = All_case_deaths ,group = Year)
) +
  geom_line(color = "grey75", alpha = 0.8)+
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates in Russia compared to historical averages",
    subtitle = "Number of deaths per weeks from all causes  vs. 2021"
  ) +
  geom_line(
    data = North_Western_Federal_District_pandemia2021,
    color = "firebrick"
  )+geom_ribbon(
    data = North_Western_Federal_District_pandemia2021,
    aes(ymin = pmin(expectdeaths, All_case_deaths), ymax = All_case_deaths, 
), 
    fill = "tomato", 
    alpha = 0.5
    )+
  geom_line(
    data = North_Western_Federal_District_pandemia2021,
    color = "blue"
  )+
  geom_line(
    data = North_Western_Federal_District_pandemia2021,
    aes(x = week,y = expectdeaths ),
    color = "black",
    inherit.aes = FALSE 
    )+
    facet_wrap(vars(VARNAME_1), scales = "free_y") +
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates compared to historical averages",
    subtitle = "Number of deaths per week from all causes 2021  vs. recent years"
    )+
 ft_theme()

 gg_North_Western_Federal_District2020
 gg_North_Western_Federal_District2021

jpeg(file = "North_Western_Federal_District2020.jpg", quality = 100, width = 1000, height = 1000) 
#pdf(file = "Central_Federal_District2020.pdf")
gg_North_Western_Federal_District2020
dev.off()

jpeg(file = "North_Western_Federal_District2021.jpg", quality = 100, width = 1000, height = 1000) 
gg_North_Western_Federal_District2021
dev.off() 
```


```{r}

Southern_Federal_District_pandemia2020 <- Southern_Federal_District_pandemia %>% 
  filter( Year == 2020)

Southern_Federal_District_pandemia2021 <- Southern_Federal_District_pandemia %>% 
  filter( Year == 2021)
gg_Southern_Federal_District2020 <- ggplot(
  Southern_Federal_District_before,  aes(x = week ,y = All_case_deaths ,group = Year)
) +
  geom_line(color = "grey75", alpha = 0.8)+
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates in Russia compared to historical averages",
    subtitle = "Number of deaths per weeks from all causes  vs. 2020"
  ) +
  geom_line(
    data = Southern_Federal_District_pandemia2020,
    color = "firebrick"
  )+geom_ribbon(
    data = Southern_Federal_District_pandemia2020,
    aes(ymin = pmin(expectdeaths, All_case_deaths), ymax = All_case_deaths, 
), 
    fill = "tomato", 
    alpha = 0.5
    )+
  geom_line(
    data = Southern_Federal_District_pandemia2020,
    color = "blue"
  )+
  geom_line(
    data = Southern_Federal_District_pandemia2020,
    aes(x = week,y = expectdeaths ),
    color = "black",
    inherit.aes = FALSE 
    )+
    facet_wrap(vars(VARNAME_1), scales = "free_y") +
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates compared to historical averages",
    subtitle = "Number of deaths per week from all causes 2020  vs. recent years"
    )+
 ft_theme()

gg_Southern_Federal_District2021 <- ggplot(
  Southern_Federal_District_before,  aes(x = week ,y = All_case_deaths ,group = Year)
) +
  geom_line(color = "grey75", alpha = 0.8)+
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates in Russia compared to historical averages",
    subtitle = "Number of deaths per weeks from all causes  vs. 2020"
  ) +
  geom_line(
    data = Southern_Federal_District_pandemia2021,
    color = "firebrick"
  )+geom_ribbon(
    data = Southern_Federal_District_pandemia2021,
    aes(ymin = pmin(expectdeaths, All_case_deaths), ymax = All_case_deaths, 
), 
    fill = "tomato", 
    alpha = 0.5
    )+
  geom_line(
    data = Southern_Federal_District_pandemia2021,
    color = "blue"
  )+
  geom_line(
    data = Southern_Federal_District_pandemia2021,
    aes(x = week,y = expectdeaths ),
    color = "black",
    inherit.aes = FALSE 
    )+
    facet_wrap(vars(VARNAME_1), scales = "free_y") +
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates compared to historical averages",
    subtitle = "Number of deaths per week from all causes 2021  vs. recent years"
    )+
 ft_theme()

 gg_Southern_Federal_District2020
 gg_Southern_Federal_District2021

jpeg(file = "Southern_Federal_District2020.jpg", quality = 100, width = 1000, height = 1000) 
#pdf(file = "Central_Federal_District2020.pdf")
gg_Southern_Federal_District2020
dev.off()

jpeg(file = "Southern_Federal_District2021.jpg", quality = 100, width = 1000, height = 1000) 
gg_Southern_Federal_District2021
dev.off() 
```

```{r}

North_Caucasus_Federal_District_pandemia2020 <- North_Caucasus_Federal_District_pandemia %>% 
  filter( Year == 2020)

North_Caucasus_Federal_District_pandemia2021 <- North_Caucasus_Federal_District_pandemia %>% 
  filter( Year == 2021)

gg_North_Caucasus_Federal_District2020 <- ggplot(
  North_Caucasus_Federal_District_before,  aes(x = week ,y = All_case_deaths ,group = Year)
) +
  geom_line(color = "grey75", alpha = 0.8)+
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates in Russia compared to historical averages",
    subtitle = "Number of deaths per weeks from all causes  vs. 2020"
  ) +
  geom_line(
    data = North_Caucasus_Federal_District_pandemia2020,
    color = "firebrick"
  )+geom_ribbon(
    data = North_Caucasus_Federal_District_pandemia2020,
    aes(ymin = pmin(expectdeaths, All_case_deaths), ymax = All_case_deaths, 
), 
    fill = "tomato", 
    alpha = 0.5
    )+
  geom_line(
    data = North_Caucasus_Federal_District_pandemia2020,
    color = "blue"
  )+
  geom_line(
    data = North_Caucasus_Federal_District_pandemia2020,
    aes(x = week,y = expectdeaths ),
    color = "black",
    inherit.aes = FALSE 
    )+
    facet_wrap(vars(VARNAME_1), scales = "free_y") +
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates compared to historical averages",
    subtitle = "Number of deaths per week from all causes 2020  vs. recent years"
    )+
 ft_theme()

gg_North_Caucasus_Federal_District2021 <- ggplot(
  North_Caucasus_Federal_District_before,  aes(x = week ,y = All_case_deaths ,group = Year)
) +
  geom_line(color = "grey75", alpha = 0.8)+
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates in Russia compared to historical averages",
    subtitle = "Number of deaths per weeks from all causes  vs. 2020"
  ) +
  geom_line(
    data = North_Caucasus_Federal_District_pandemia2021,
    color = "firebrick"
  )+geom_ribbon(
    data = North_Caucasus_Federal_District_pandemia2021,
    aes(ymin = pmin(expectdeaths, All_case_deaths), ymax = All_case_deaths, 
), 
    fill = "tomato", 
    alpha = 0.5
    )+
  geom_line(
    data = North_Caucasus_Federal_District_pandemia2021,
    color = "blue"
  )+
  geom_line(
    data = North_Caucasus_Federal_District_pandemia2021,
    aes(x = week,y = expectdeaths ),
    color = "black",
    inherit.aes = FALSE 
    )+
    facet_wrap(vars(VARNAME_1), scales = "free_y") +
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates compared to historical averages",
    subtitle = "Number of deaths per week from all causes 2021  vs. recent years"
    )+
 ft_theme()

 gg_North_Caucasus_Federal_District2020
 gg_North_Caucasus_Federal_District2021

jpeg(file = "North_Caucasus_Federal_District2020.jpg", quality = 100, width = 1000, height = 1000) 
#pdf(file = "Central_Federal_District2020.pdf")
gg_North_Caucasus_Federal_District2020
dev.off()

jpeg(file = "North_Caucasus_Federal_District2021.jpg", quality = 100, width = 1000, height = 1000) 
gg_North_Caucasus_Federal_District2021
dev.off() 
```
 
```{r}

 Volga_Federal_District_pandemia2020 <- Volga_Federal_District_pandemia %>% 
  filter( Year == 2020)

 Volga_Federal_District_pandemia2021 <- Volga_Federal_District_pandemia %>% 
  filter( Year == 2021)

gg_Volga_Federal_District2020 <- ggplot(
   Volga_Federal_District_before,  aes(x = week ,y = All_case_deaths ,group = Year)
) +
  geom_line(color = "grey75", alpha = 0.8)+
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates in Russia compared to historical averages",
    subtitle = "Number of deaths per weeks from all causes  vs. 2020"
  ) +
  geom_line(
    data =Volga_Federal_District_pandemia2020,
    color = "firebrick"
  )+geom_ribbon(
    data = Volga_Federal_District_pandemia2020,
    aes(ymin = pmin(expectdeaths, All_case_deaths), ymax = All_case_deaths, 
), 
    fill = "tomato", 
    alpha = 0.5
    )+
  geom_line(
    data = Volga_Federal_District_pandemia2020,
    color = "blue"
  )+
  geom_line(
    data = Volga_Federal_District_pandemia2020,
    aes(x = week,y = expectdeaths ),
    color = "black",
    inherit.aes = FALSE 
    )+
    facet_wrap(vars(VARNAME_1), scales = "free_y") +
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates compared to historical averages",
    subtitle = "Number of deaths per week from all causes 2020  vs. recent years"
    )+
 ft_theme()

gg_Volga_Federal_District2021 <- ggplot(
  Volga_Federal_District_before,  aes(x = week ,y = All_case_deaths ,group = Year)
) +
  geom_line(color = "grey75", alpha = 0.8)+
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates in Russia compared to historical averages",
    subtitle = "Number of deaths per weeks from all causes  vs. 2020"
  ) +
  geom_line(
    data = Volga_Federal_District_pandemia2021,
    color = "firebrick"
  )+geom_ribbon(
    data = Volga_Federal_District_pandemia2021,
    aes(ymin = pmin(expectdeaths, All_case_deaths), ymax = All_case_deaths, 
), 
    fill = "tomato", 
    alpha = 0.5
    )+
  geom_line(
    data = Volga_Federal_District_pandemia2021,
    color = "blue"
  )+
  geom_line(
    data = Volga_Federal_District_pandemia2021,
    aes(x = week,y = expectdeaths ),
    color = "black",
    inherit.aes = FALSE 
    )+
    facet_wrap(vars(VARNAME_1), scales = "free_y") +
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates compared to historical averages",
    subtitle = "Number of deaths per week from all causes 2021  vs. recent years"
    )+
 ft_theme()

 gg_Volga_Federal_District2020
 gg_Volga_Federal_District2021

jpeg(file = "Volga_Federal_District2020.jpg", quality = 100, width = 1000, height = 1000) 
#pdf(file = "Central_Federal_District2020.pdf")
gg_Volga_Federal_District2020
dev.off()

jpeg(file = "Volga_Federal_District2021.jpg", quality = 100, width = 1000, height = 1000) 
gg_Volga_Federal_District2021
dev.off() 
```

```{r}

 Siberian_Federal_District_pandemia2020 <- Siberian_Federal_District_pandemia %>% 
  filter( Year == 2020)

 Siberian_Federal_District_pandemia2021 <- Siberian_Federal_District_pandemia %>% 
  filter( Year == 2021)

gg_Siberian_Federal_District2020 <- ggplot(
   Siberian_Federal_District_before,  aes(x = week ,y = All_case_deaths ,group = Year)
) +
  geom_line(color = "grey75", alpha = 0.8)+
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates in Russia compared to historical averages",
    subtitle = "Number of deaths per weeks from all causes  vs. 2020"
  ) +
  geom_line(
    data =Siberian_Federal_District_pandemia2020,
    color = "firebrick"
  )+geom_ribbon(
    data = Siberian_Federal_District_pandemia2020,
    aes(ymin = pmin(expectdeaths, All_case_deaths), ymax = All_case_deaths, 
), 
    fill = "tomato", 
    alpha = 0.5
    )+
  geom_line(
    data = Siberian_Federal_District_pandemia2020,
    color = "blue"
  )+
  geom_line(
    data = Siberian_Federal_District_pandemia2020,
    aes(x = week,y = expectdeaths ),
    color = "black",
    inherit.aes = FALSE 
    )+
    facet_wrap(vars(VARNAME_1), scales = "free_y") +
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates compared to historical averages",
    subtitle = "Number of deaths per week from all causes 2020  vs. recent years"
    )+
 ft_theme()

gg_Siberian_Federal_District2021 <- ggplot(
  Siberian_Federal_District_before,  aes(x = week ,y = All_case_deaths ,group = Year)
) +
  geom_line(color = "grey75", alpha = 0.8)+
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates in Russia compared to historical averages",
    subtitle = "Number of deaths per weeks from all causes  vs. 2020"
  ) +
  geom_line(
    data = Siberian_Federal_District_pandemia2021,
    color = "firebrick"
  )+geom_ribbon(
    data = Siberian_Federal_District_pandemia2021,
    aes(ymin = pmin(expectdeaths, All_case_deaths), ymax = All_case_deaths, 
), 
    fill = "tomato", 
    alpha = 0.5
    )+
  geom_line(
    data = Siberian_Federal_District_pandemia2021,
    color = "blue"
  )+
  geom_line(
    data = Siberian_Federal_District_pandemia2021,
    aes(x = week,y = expectdeaths ),
    color = "black",
    inherit.aes = FALSE 
    )+
    facet_wrap(vars(VARNAME_1), scales = "free_y") +
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates compared to historical averages",
    subtitle = "Number of deaths per week from all causes 2021  vs. recent years"
    )+
 ft_theme()

 gg_Siberian_Federal_District2020
 gg_Siberian_Federal_District2021

jpeg(file = "Siberian_Federal_District2020.jpg", quality = 100, width = 1000, height = 1000) 
#pdf(file = "Central_Federal_District2020.pdf")
gg_Siberian_Federal_District2020
dev.off()

jpeg(file = "Siberian_Federal_District2021.jpg", quality = 100, width = 1000, height = 1000) 
gg_Siberian_Federal_District2021
dev.off() 
```

```{r}

 Far_Eastern_Federal_District_pandemia2020 <- Far_Eastern_Federal_District_pandemia %>% 
  filter( Year == 2020)

 Far_Eastern_Federal_District_pandemia2021 <- Far_Eastern_Federal_District_pandemia %>% 
  filter( Year == 2021)

gg_Far_Eastern_Federal_District2020 <- ggplot(
   Far_Eastern_Federal_District_before,  aes(x = week ,y = All_case_deaths ,group = Year)
) +
  geom_line(color = "grey75", alpha = 0.8)+
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates in Russia compared to historical averages",
    subtitle = "Number of deaths per weeks from all causes  vs. 2020"
  ) +
  geom_line(
    data =Far_Eastern_Federal_District_pandemia2020,
    color = "firebrick"
  )+geom_ribbon(
    data = Far_Eastern_Federal_District_pandemia2020,
    aes(ymin = pmin(expectdeaths, All_case_deaths), ymax = All_case_deaths, 
), 
    fill = "tomato", 
    alpha = 0.5
    )+
  geom_line(
    data = Far_Eastern_Federal_District_pandemia2020,
    color = "blue"
  )+
  geom_line(
    data = Far_Eastern_Federal_District_pandemia2020,
    aes(x = week,y = expectdeaths ),
    color = "black",
    inherit.aes = FALSE 
    )+
    facet_wrap(vars(VARNAME_1), scales = "free_y") +
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates compared to historical averages",
    subtitle = "Number of deaths per week from all causes 2020  vs. recent years"
    )+
 ft_theme()

gg_Far_Eastern_Federal_District2021 <- ggplot(
  Far_Eastern_Federal_District_before,  aes(x = week ,y = All_case_deaths ,group = Year)
) +
  geom_line(color = "grey75", alpha = 0.8)+
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates in Russia compared to historical averages",
    subtitle = "Number of deaths per weeks from all causes  vs. 2020"
  ) +
  geom_line(
    data = Far_Eastern_Federal_District_pandemia2021,
    color = "firebrick"
  )+geom_ribbon(
    data = Far_Eastern_Federal_District_pandemia2021,
    aes(ymin = pmin(expectdeaths, All_case_deaths), ymax = All_case_deaths, 
), 
    fill = "tomato", 
    alpha = 0.5
    )+
  geom_line(
    data = Far_Eastern_Federal_District_pandemia2021,
    color = "blue"
  )+
  geom_line(
    data = Far_Eastern_Federal_District_pandemia2021,
    aes(x = week,y = expectdeaths ),
    color = "black",
    inherit.aes = FALSE 
    )+
    facet_wrap(vars(VARNAME_1), scales = "free_y") +
    labs(
    x = "Weeks", 
    y = "Deaths",
    title = "Death rates compared to historical averages",
    subtitle = "Number of deaths per week from all causes 2021  vs. recent years"
    )+
 ft_theme()

 gg_Far_Eastern_Federal_District2020
 gg_Far_Eastern_Federal_District2021

jpeg(file = "Far_Eastern_Federal_District2020.jpg", quality = 100, width = 1000, height = 1000) 
#pdf(file = "Central_Federal_District2020.pdf")
gg_Far_Eastern_Federal_District2020
dev.off()

jpeg(file = "Far_Eastern_Federal_District2021.jpg", quality = 100, width = 1000, height = 1000) 
gg_Far_Eastern_Federal_District2021
dev.off() 
```

```{r}
library(gapminder)
library(ggplot2)
library(gganimate)
library(animation)
p <- ggplot(
  pandemia_russia_district, 
  aes(x = mounth, y = All_case_deaths, size = MR , colour =factor(Year))
  ) +
  geom_point(show.legend = FALSE, alpha = 0.7) +
  scale_color_viridis_d() +
  scale_size(range = c(2, 12)) +
  scale_x_log10() +
  labs(x = "mounth", y = "All_case_deaths")
p
gif1<- p + facet_wrap(~VARNAME_1) +
  transition_time(mounth) +
  labs(title = "Mounth: {frame_time}")
gif1
#animate(gif1, height = 800, width =800)
#anim_save("Gapminder_example.gif")


```


```{r}
p <- ggplot(
   pandemia_russia_district,
   aes(x = mounth, y = All_case_deaths , colour =factor(Year))
   ) +
   geom_line() +
   scale_colour_manual(values = c("red", "blue")) +
   labs(x = "Month", y = "All_case_deaths") +
   theme(legend.position = "top")
p
gif2<-p + facet_wrap(~VARNAME_1) +
  geom_point() +
  transition_reveal(mounth)
gif2
animate(gif2, height = 900, width = 900)
anim_save("Gapminder_example2.gif")
```

```{r}

gifd<-  pandemia_russia_district %>% 
  filter(VARNAME_1 =="Central Federal District"| VARNAME_1 =="North Caucasus Federal District" | VARNAME_1 =="Far Eastern Federal District" )
 library(gifski)
 
p <- ggplot(pandemia_russia_district ,
     aes(x = week, y = All_case_deaths , colour =factor(Year))
    ) +
   geom_line(
     data =pandemia_russia_district,
     color = "firebrick"
   )+geom_ribbon(
     data = pandemia_russia_district,
     aes(ymin = pmin(expectdeaths, All_case_deaths), ymax = All_case_deaths, 
 ), 
     fill = "tomato", 
     alpha = 0.5
     )+
   geom_line(
     data = pandemia_russia_district,
   )+
   geom_line(
     data = pandemia_russia_district,
     aes(x = week,y = expectdeaths ),
     color = "black",
     inherit.aes = FALSE 
     )+
    scale_colour_manual(values = c("red", "blue")) +
    labs(x = "Month", y = "All_case_deaths") +
    theme(legend.position = "top")
 p
 gifcfd <- p+ facet_wrap(~VARNAME_1+ Year,nrow = 3 ) +
   geom_point() +
   transition_reveal(week)
 animate(gifcfd, fps =10,height = 900, width = 900, renderer = gifski_renderer(loop = FALSE))
anim_save("Gapminder_dist.gif")



```


```{r}

p <- ggplot(pandemia_russia_district[pandemia_russia_district$VARNAME_1=="North Caucasus Federal District",] ,
     aes(x = week, y = All_case_deaths , colour =factor(Year))
    ) +
   geom_line(
     data =pandemia_russia_district[pandemia_russia_district$VARNAME_1=="North Caucasus Federal District",],
     color = "firebrick"
   )+geom_ribbon(
     data = pandemia_russia_district[pandemia_russia_district$VARNAME_1=="North Caucasus Federal District",],
     aes(ymin = pmin(expectdeaths, All_case_deaths), ymax = All_case_deaths, 
 ), 
     fill = "tomato", 
     alpha = 0.5
     )+
   geom_line(
     data = pandemia_russia_district[pandemia_russia_district$VARNAME_1=="North Caucasus Federal District",],
   )+
   geom_line(
     data = pandemia_russia_district[pandemia_russia_district$VARNAME_1=="North Caucasus Federal District",],
     aes(x = week,y = expectdeaths ),
     color = "black",
     inherit.aes = FALSE 
     )+
    scale_colour_manual(values = c("red", "blue")) +
    labs(x = "Month", y = "All_case_deaths") +
    theme(legend.position = "top")
 p
 gifNCFD <- p+ facet_wrap(~Year) +
   geom_point() +
   transition_reveal(week)
 animate(gifNCFD, fps =10,height = 600, width = 600, renderer = gifski_renderer(loop = FALSE))
anim_save("Gapminder_NCFD.gif")


```

```{r}

p <- ggplot(
   pandemia_russia_all,
   aes(x = week, y = All_case_deaths , colour =factor(Year))
   ) +
  geom_line(
    data =pandemia_russia_all,
    color = "firebrick"
  )+geom_ribbon(
    data = pandemia_russia_all,
    aes(ymin = pmin(expectdeaths, All_case_deaths), ymax = All_case_deaths, 
), 
    fill = "tomato", 
    alpha = 0.5
    )+
  geom_line(
    data = pandemia_russia_all,
  )+
  geom_line(
    data = pandemia_russia_all,
    aes(x = week,y = expectdeaths ),
    color = "black",
    inherit.aes = FALSE 
    )+
   scale_colour_manual(values = c("red", "blue")) +theme_calc()+theme(axis.text = element_text(size = 10))+
   labs(x = "Month", y = "All_case_deaths") +
   theme(legend.position = "top")
p
gif4<-p + facet_wrap(~Year) +
  geom_point() +
  transition_reveal(week)
animate(gif4, fps = 10,height = 900, width = 900)

anim_save("Gapminder_Russia.gif")



```


```{r}
library(gapminder)


ggplot(before_russia_district , aes(week,`population average per year`, size = `population average per year`, colour = VARNAME_1)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  scale_colour_manual(values = country_colors) +
  scale_size(range = c(2, 12)) +
  scale_x_log10() +
  facet_wrap(~VARNAME_1) +
  # Here comes the gganimate specific bits
  labs(title = 'Year: {frame_time}', x = 'Week', y = 'Population average per year') +
  transition_time(week) +
  ease_aes('linear')


```


```{r}

library("ggplot2")
library(ggthemes)
setwd("~/Все/Документы 2021/Charite/Master topic/R code")
nmo <- read_excel("NMO.xlsx")

nmor<-  nmo %>% 
  filter(VARNAME_1 == "Russian federation")

p <- ggplot(nmor,  aes(Year, NMO, color = factor(VARNAME_1))
  ) +
  geom_line(size = 3) +theme_calc()+theme(axis.text = element_text(size = 15))+
scale_colour_manual(values = c("red")) +
  labs(x = "Years", y = "Number medical organisation") 
  theme(legend.position = "top")
p

p + transition_reveal(Year)
gif5<-p + facet_wrap(~VARNAME_1) +
  geom_point()+
  transition_reveal(Year)
animate(gif5,fps = 2,height = 900, width = 900)

anim_save("Gapminder_NMO_rus.gif")

```

```{r}
library("ggplot2")
library(ggthemes)
setwd("~/Все/Документы 2021/Charite/Master topic/R code")
nmo <- read_excel("NMO.xlsx")

nmod<-  nmo %>% 
  filter(VARNAME_1 != "Russian federation")

p <- ggplot(nmod,  aes(Year, NMO, color = factor(VARNAME_1))
  ) +
  geom_line(size = 3) +theme_calc()+theme(axis.text = element_text(size = 15))+
scale_colour_manual(values = c("red","blue","coral","darkgoldenrod1","darkmagenta","darkolivegreen","deeppink","palevioletred1")) +
  labs(x = "Years", y = "Number medical organisation") 
  theme(legend.position = "top")
p

p + transition_reveal(Year)
gif5<-p + facet_wrap(~VARNAME_1) +
  geom_point()+
  transition_reveal(Year)
animate(gif5,fps = 2,height = 900, width = 900)

anim_save("Gapminder_NMO_dist.gif")


```